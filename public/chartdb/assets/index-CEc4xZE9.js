import{S as Jt,c as Sa}from"./index-BKsfrmP9.js";import{Z as x,c as Ta,z as g}from"./use-storage-CxjMvB6O.js";import"./index-DngGMs-x.js";import"./database-type-C2NNW5SW.js";var Gn="vercel.ai.error",xa=Symbol.for(Gn),zn,Ia=class Wn extends Error{constructor({name:t,message:n,cause:r}){super(n),this[zn]=!0,this.name=t,this.cause=r}static isInstance(t){return Wn.hasMarker(t,Gn)}static hasMarker(t,n){const r=Symbol.for(n);return t!=null&&typeof t=="object"&&r in t&&typeof t[r]=="boolean"&&t[r]===!0}toJSON(){return{name:this.name,message:this.message}}};zn=xa;var Rn=Ia,Kn="AI_InvalidArgumentError",Yn=`vercel.ai.error.${Kn}`,Ea=Symbol.for(Yn),Hn,Aa=class extends Rn{constructor({message:t,cause:n,argument:r}){super({name:Kn,message:t,cause:n}),this[Hn]=!0,this.argument=r}static isInstance(t){return Rn.hasMarker(t,Yn)}};Hn=Ea;let ka=(e,t=21)=>(n=t)=>{let r="",a=n|0;for(;a--;)r+=e[Math.random()*e.length|0];return r};var Ra=({prefix:e,size:t=7,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{const a=ka(n,t);if(e==null)return a;if(n.includes(r))throw new Aa({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${n}".`});return s=>`${e}${r}${a(s)}`},Xn=Ra(),Na=Symbol.for("vercel.ai.validator");const Ca=Symbol("Let zodToJsonSchema decide on which parser to use"),Oa={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Ma=e=>({...Oa,...e}),Pa=e=>{const t=Ma(e),n=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([r,a])=>[a._def,{def:a._def,path:[...t.basePath,t.definitionPath,r],jsonSchema:void 0}]))}};function Qn(e,t,n,r){r!=null&&r.errorMessages&&n&&(e.errorMessage={...e.errorMessage,[t]:n})}function D(e,t,n,r,a){e[t]=n,Qn(e,t,r,a)}function ja(){return{}}function Da(e,t){var r,a,s;const n={type:"array"};return(r=e.type)!=null&&r._def&&((s=(a=e.type)==null?void 0:a._def)==null?void 0:s.typeName)!==x.ZodAny&&(n.items=O(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&D(n,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&D(n,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(D(n,"minItems",e.exactLength.value,e.exactLength.message,t),D(n,"maxItems",e.exactLength.value,e.exactLength.message,t)),n}function $a(e,t){const n={type:"integer",format:"int64"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"min":t.target==="jsonSchema7"?r.inclusive?D(n,"minimum",r.value,r.message,t):D(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),D(n,"minimum",r.value,r.message,t));break;case"max":t.target==="jsonSchema7"?r.inclusive?D(n,"maximum",r.value,r.message,t):D(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),D(n,"maximum",r.value,r.message,t));break;case"multipleOf":D(n,"multipleOf",r.value,r.message,t);break}return n}function qa(){return{type:"boolean"}}function er(e,t){return O(e.type._def,t)}const Fa=(e,t)=>O(e.innerType._def,t);function tr(e,t,n){const r=n??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((a,s)=>tr(e,t,a))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Ua(e,t)}}const Ua=(e,t)=>{const n={type:"integer",format:"unix-time"};if(t.target==="openApi3")return n;for(const r of e.checks)switch(r.kind){case"min":D(n,"minimum",r.value,r.message,t);break;case"max":D(n,"maximum",r.value,r.message,t);break}return n};function Ja(e,t){return{...O(e.innerType._def,t),default:e.defaultValue()}}function La(e,t){return t.effectStrategy==="input"?O(e.schema._def,t):{}}function Ba(e){return{type:"string",enum:Array.from(e.values)}}const Za=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function Va(e,t){const n=[O(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),O(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(s=>!!s);let r=t.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const a=[];return n.forEach(s=>{if(Za(s))a.push(...s.allOf),s.unevaluatedProperties===void 0&&(r=void 0);else{let o=s;if("additionalProperties"in s&&s.additionalProperties===!1){const{additionalProperties:i,...u}=s;o=u}else r=void 0;a.push(o)}}),a.length?{allOf:a,...r}:void 0}function Ga(e,t){const n=typeof e.value;return n!=="bigint"&&n!=="number"&&n!=="boolean"&&n!=="string"?{type:Array.isArray(e.value)?"array":"object"}:t.target==="openApi3"?{type:n==="bigint"?"integer":n,enum:[e.value]}:{type:n==="bigint"?"integer":n,const:e.value}}let jt;const be={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(jt===void 0&&(jt=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),jt),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function nr(e,t){const n={type:"string"};if(e.checks)for(const r of e.checks)switch(r.kind){case"min":D(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,t);break;case"max":D(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,t);break;case"email":switch(t.emailStrategy){case"format:email":we(n,"email",r.message,t);break;case"format:idn-email":we(n,"idn-email",r.message,t);break;case"pattern:zod":le(n,be.email,r.message,t);break}break;case"url":we(n,"uri",r.message,t);break;case"uuid":we(n,"uuid",r.message,t);break;case"regex":le(n,r.regex,r.message,t);break;case"cuid":le(n,be.cuid,r.message,t);break;case"cuid2":le(n,be.cuid2,r.message,t);break;case"startsWith":le(n,RegExp(`^${Dt(r.value,t)}`),r.message,t);break;case"endsWith":le(n,RegExp(`${Dt(r.value,t)}$`),r.message,t);break;case"datetime":we(n,"date-time",r.message,t);break;case"date":we(n,"date",r.message,t);break;case"time":we(n,"time",r.message,t);break;case"duration":we(n,"duration",r.message,t);break;case"length":D(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,t),D(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,t);break;case"includes":{le(n,RegExp(Dt(r.value,t)),r.message,t);break}case"ip":{r.version!=="v6"&&we(n,"ipv4",r.message,t),r.version!=="v4"&&we(n,"ipv6",r.message,t);break}case"base64url":le(n,be.base64url,r.message,t);break;case"jwt":le(n,be.jwt,r.message,t);break;case"cidr":{r.version!=="v6"&&le(n,be.ipv4Cidr,r.message,t),r.version!=="v4"&&le(n,be.ipv6Cidr,r.message,t);break}case"emoji":le(n,be.emoji(),r.message,t);break;case"ulid":{le(n,be.ulid,r.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{we(n,"binary",r.message,t);break}case"contentEncoding:base64":{D(n,"contentEncoding","base64",r.message,t);break}case"pattern:zod":{le(n,be.base64,r.message,t);break}}break}case"nanoid":le(n,be.nanoid,r.message,t)}return n}function Dt(e,t){return t.patternStrategy==="escape"?Wa(e):e}const za=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Wa(e){let t="";for(let n=0;n<e.length;n++)za.has(e[n])||(t+="\\"),t+=e[n];return t}function we(e,t,n,r){var a;e.format||(a=e.anyOf)!=null&&a.some(s=>s.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&r.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):D(e,"format",t,n,r)}function le(e,t,n,r){var a;e.pattern||(a=e.allOf)!=null&&a.some(s=>s.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&r.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.allOf.push({pattern:Nn(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):D(e,"pattern",Nn(t,r),n,r)}function Nn(e,t){var u;if(!t.applyRegexFlags||!e.flags)return e.source;const n={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},r=n.i?e.source.toLowerCase():e.source;let a="",s=!1,o=!1,i=!1;for(let l=0;l<r.length;l++){if(s){a+=r[l],s=!1;continue}if(n.i){if(o){if(r[l].match(/[a-z]/)){i?(a+=r[l],a+=`${r[l-2]}-${r[l]}`.toUpperCase(),i=!1):r[l+1]==="-"&&((u=r[l+2])!=null&&u.match(/[a-z]/))?(a+=r[l],i=!0):a+=`${r[l]}${r[l].toUpperCase()}`;continue}}else if(r[l].match(/[a-z]/)){a+=`[${r[l]}${r[l].toUpperCase()}]`;continue}}if(n.m){if(r[l]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(r[l]==="$"){a+=`($|(?=[\r
]))`;continue}}if(n.s&&r[l]==="."){a+=o?`${r[l]}\r
`:`[${r[l]}\r
]`;continue}a+=r[l],r[l]==="\\"?s=!0:o&&r[l]==="]"?o=!1:!o&&r[l]==="["&&(o=!0)}try{new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return a}function rr(e,t){var r,a,s,o,i,u;if(t.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),t.target==="openApi3"&&((r=e.keyType)==null?void 0:r._def.typeName)===x.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((l,c)=>({...l,[c]:O(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",c]})??{}}),{}),additionalProperties:!1};const n={type:"object",additionalProperties:O(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if(t.target==="openApi3")return n;if(((a=e.keyType)==null?void 0:a._def.typeName)===x.ZodString&&((s=e.keyType._def.checks)!=null&&s.length)){const{type:l,...c}=nr(e.keyType._def,t);return{...n,propertyNames:c}}else{if(((o=e.keyType)==null?void 0:o._def.typeName)===x.ZodEnum)return{...n,propertyNames:{enum:e.keyType._def.values}};if(((i=e.keyType)==null?void 0:i._def.typeName)===x.ZodBranded&&e.keyType._def.type._def.typeName===x.ZodString&&((u=e.keyType._def.type._def.checks)!=null&&u.length)){const{type:l,...c}=er(e.keyType._def,t);return{...n,propertyNames:c}}}return n}function Ka(e,t){if(t.mapStrategy==="record")return rr(e,t);const n=O(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},r=O(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[n,r],minItems:2,maxItems:2}}}function Ya(e){const t=e.values,r=Object.keys(e.values).filter(s=>typeof t[t[s]]!="number").map(s=>t[s]),a=Array.from(new Set(r.map(s=>typeof s)));return{type:a.length===1?a[0]==="string"?"string":"number":["string","number"],enum:r}}function Ha(){return{not:{}}}function Xa(e){return e.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const wt={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Qa(e,t){if(t.target==="openApi3")return Cn(e,t);const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(r=>r._def.typeName in wt&&(!r._def.checks||!r._def.checks.length))){const r=n.reduce((a,s)=>{const o=wt[s._def.typeName];return o&&!a.includes(o)?[...a,o]:a},[]);return{type:r.length>1?r:r[0]}}else if(n.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=n.reduce((a,s)=>{const o=typeof s._def.value;switch(o){case"string":case"number":case"boolean":return[...a,o];case"bigint":return[...a,"integer"];case"object":if(s._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(r.length===n.length){const a=r.filter((s,o,i)=>i.indexOf(s)===o);return{type:a.length>1?a:a[0],enum:n.reduce((s,o)=>s.includes(o._def.value)?s:[...s,o._def.value],[])}}}else if(n.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((r,a)=>[...r,...a._def.values.filter(s=>!r.includes(s))],[])};return Cn(e,t)}const Cn=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((r,a)=>O(r._def,{...t,currentPath:[...t.currentPath,"anyOf",`${a}`]})).filter(r=>!!r&&(!t.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return n.length?{anyOf:n}:void 0};function es(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return t.target==="openApi3"?{type:wt[e.innerType._def.typeName],nullable:!0}:{type:[wt[e.innerType._def.typeName],"null"]};if(t.target==="openApi3"){const r=O(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const n=O(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function ts(e,t){const n={type:"number"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"int":n.type="integer",Qn(n,"type",r.message,t);break;case"min":t.target==="jsonSchema7"?r.inclusive?D(n,"minimum",r.value,r.message,t):D(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),D(n,"minimum",r.value,r.message,t));break;case"max":t.target==="jsonSchema7"?r.inclusive?D(n,"maximum",r.value,r.message,t):D(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),D(n,"maximum",r.value,r.message,t));break;case"multipleOf":D(n,"multipleOf",r.value,r.message,t);break}return n}function ns(e,t){return t.removeAdditionalStrategy==="strict"?e.catchall._def.typeName==="ZodNever"?e.unknownKeys!=="strict":O(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0:e.catchall._def.typeName==="ZodNever"?e.unknownKeys==="passthrough":O(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0}function rs(e,t){const n=t.target==="openAi",r={type:"object",...Object.entries(e.shape()).reduce((a,[s,o])=>{if(o===void 0||o._def===void 0)return a;let i=o.isOptional();i&&n&&(o instanceof Ta&&(o=o._def.innerType),o.isNullable()||(o=o.nullable()),i=!1);const u=O(o._def,{...t,currentPath:[...t.currentPath,"properties",s],propertyPath:[...t.currentPath,"properties",s]});return u===void 0?a:{properties:{...a.properties,[s]:u},required:i?a.required:[...a.required,s]}},{properties:{},required:[]}),additionalProperties:ns(e,t)};return r.required.length||delete r.required,r}const as=(e,t)=>{var r;if(t.currentPath.toString()===((r=t.propertyPath)==null?void 0:r.toString()))return O(e.innerType._def,t);const n=O(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:{}},n]}:{}},ss=(e,t)=>{if(t.pipeStrategy==="input")return O(e.in._def,t);if(t.pipeStrategy==="output")return O(e.out._def,t);const n=O(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),r=O(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,r].filter(a=>a!==void 0)}};function os(e,t){return O(e.type._def,t)}function is(e,t){const r={type:"array",uniqueItems:!0,items:O(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&D(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&D(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}function ls(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((n,r)=>O(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[]),additionalItems:O(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((n,r)=>O(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[])}}function us(){return{not:{}}}function cs(){return{}}const ds=(e,t)=>O(e.innerType._def,t);function O(e,t,n=!1){var o;const r=t.seen.get(e);if(t.override){const i=(o=t.override)==null?void 0:o.call(t,e,t,r,n);if(i!==Ca)return i}if(r&&!n){const i=ps(r,t);if(i!==void 0)return i}const a={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,a);const s=ms(e,e.typeName,t);return s&&gs(e,t,s),a.jsonSchema=s,s}const ps=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:fs(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((n,r)=>t.currentPath[r]===n)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):t.$refStrategy==="seen"?{}:void 0}},fs=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")},ms=(e,t,n)=>{switch(t){case x.ZodString:return nr(e,n);case x.ZodNumber:return ts(e,n);case x.ZodObject:return rs(e,n);case x.ZodBigInt:return $a(e,n);case x.ZodBoolean:return qa();case x.ZodDate:return tr(e,n);case x.ZodUndefined:return us();case x.ZodNull:return Xa(n);case x.ZodArray:return Da(e,n);case x.ZodUnion:case x.ZodDiscriminatedUnion:return Qa(e,n);case x.ZodIntersection:return Va(e,n);case x.ZodTuple:return ls(e,n);case x.ZodRecord:return rr(e,n);case x.ZodLiteral:return Ga(e,n);case x.ZodEnum:return Ba(e);case x.ZodNativeEnum:return Ya(e);case x.ZodNullable:return es(e,n);case x.ZodOptional:return as(e,n);case x.ZodMap:return Ka(e,n);case x.ZodSet:return is(e,n);case x.ZodLazy:return O(e.getter()._def,n);case x.ZodPromise:return os(e,n);case x.ZodNaN:case x.ZodNever:return Ha();case x.ZodEffects:return La(e,n);case x.ZodAny:return ja();case x.ZodUnknown:return cs();case x.ZodDefault:return Ja(e,n);case x.ZodBranded:return er(e,n);case x.ZodReadonly:return ds(e,n);case x.ZodCatch:return Fa(e,n);case x.ZodPipeline:return ss(e,n);case x.ZodFunction:case x.ZodVoid:case x.ZodSymbol:return;default:return(r=>{})()}},gs=(e,t,n)=>(e.description&&(n.description=e.description,t.markdownDescription&&(n.markdownDescription=e.description)),n),hs=(e,t)=>{const n=Pa(t),r=void 0,a=t==null?void 0:t.name,s=O(e._def,a===void 0?n:{...n,currentPath:[...n.basePath,n.definitionPath,a]},!1)??{},o=a===void 0?r?{...s,[n.definitionPath]:r}:s:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,a].join("/"),[n.definitionPath]:{...r,[a]:s}};return n.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":(n.target==="jsonSchema2019-09"||n.target==="openAi")&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),n.target==="openAi"&&("anyOf"in o||"oneOf"in o||"allOf"in o||"type"in o&&Array.isArray(o.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),o};function ys(e){const t=["ROOT"];let n=-1,r=null;function a(u,l,c){switch(u){case'"':{n=l,t.pop(),t.push(c),t.push("INSIDE_STRING");break}case"f":case"t":case"n":{n=l,r=l,t.pop(),t.push(c),t.push("INSIDE_LITERAL");break}case"-":{t.pop(),t.push(c),t.push("INSIDE_NUMBER");break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{n=l,t.pop(),t.push(c),t.push("INSIDE_NUMBER");break}case"{":{n=l,t.pop(),t.push(c),t.push("INSIDE_OBJECT_START");break}case"[":{n=l,t.pop(),t.push(c),t.push("INSIDE_ARRAY_START");break}}}function s(u,l){switch(u){case",":{t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{n=l,t.pop();break}}}function o(u,l){switch(u){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{n=l,t.pop();break}}}for(let u=0;u<e.length;u++){const l=e[u];switch(t[t.length-1]){case"ROOT":a(l,u,"FINISH");break;case"INSIDE_OBJECT_START":{switch(l){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}case"}":{n=u,t.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{switch(l){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}}break}case"INSIDE_OBJECT_KEY":{switch(l){case'"':{t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY");break}}break}case"INSIDE_OBJECT_AFTER_KEY":{switch(l){case":":{t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE");break}}break}case"INSIDE_OBJECT_BEFORE_VALUE":{a(l,u,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{s(l,u);break}case"INSIDE_STRING":{switch(l){case'"':{t.pop(),n=u;break}case"\\":{t.push("INSIDE_STRING_ESCAPE");break}default:n=u}break}case"INSIDE_ARRAY_START":{switch(l){case"]":{n=u,t.pop();break}default:{n=u,a(l,u,"INSIDE_ARRAY_AFTER_VALUE");break}}break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(l){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{n=u,t.pop();break}default:{n=u;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{a(l,u,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{t.pop(),n=u;break}case"INSIDE_NUMBER":{switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{n=u;break}case"e":case"E":case"-":case".":break;case",":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(l,u),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&s(l,u);break}case"}":{t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&s(l,u);break}case"]":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(l,u);break}default:{t.pop();break}}break}case"INSIDE_LITERAL":{const d=e.substring(r,u+1);!"false".startsWith(d)&&!"true".startsWith(d)&&!"null".startsWith(d)?(t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?s(l,u):t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(l,u)):n=u;break}}}let i=e.slice(0,n+1);for(let u=t.length-1;u>=0;u--)switch(t[u]){case"INSIDE_STRING":{i+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{i+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{i+="]";break}case"INSIDE_LITERAL":{const c=e.substring(r,e.length);"true".startsWith(c)?i+="true".slice(c.length):"false".startsWith(c)?i+="false".slice(c.length):"null".startsWith(c)&&(i+="null".slice(c.length))}}return i}function ar(e){if(e===void 0)return{value:void 0,state:"undefined-input"};try{return{value:Jt.parse(e),state:"successful-parse"}}catch{try{return{value:Jt.parse(ys(e)),state:"repaired-parse"}}catch{}}return{value:void 0,state:"failed-parse"}}var Xe={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},Qe={code:"1",name:"function_call",parse:e=>{if(e==null||typeof e!="object"||!("function_call"in e)||typeof e.function_call!="object"||e.function_call==null||!("name"in e.function_call)||!("arguments"in e.function_call)||typeof e.function_call.name!="string"||typeof e.function_call.arguments!="string")throw new Error('"function_call" parts expect an object with a "function_call" property.');return{type:"function_call",value:e}}},et={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw new Error('"data" parts expect an array value.');return{type:"data",value:e}}},tt={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},nt={code:"4",name:"assistant_message",parse:e=>{if(e==null||typeof e!="object"||!("id"in e)||!("role"in e)||!("content"in e)||typeof e.id!="string"||typeof e.role!="string"||e.role!=="assistant"||!Array.isArray(e.content)||!e.content.every(t=>t!=null&&typeof t=="object"&&"type"in t&&t.type==="text"&&"text"in t&&t.text!=null&&typeof t.text=="object"&&"value"in t.text&&typeof t.text.value=="string"))throw new Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},rt={code:"5",name:"assistant_control_data",parse:e=>{if(e==null||typeof e!="object"||!("threadId"in e)||!("messageId"in e)||typeof e.threadId!="string"||typeof e.messageId!="string")throw new Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},at={code:"6",name:"data_message",parse:e=>{if(e==null||typeof e!="object"||!("role"in e)||!("data"in e)||typeof e.role!="string"||e.role!=="data")throw new Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},st={code:"7",name:"tool_calls",parse:e=>{if(e==null||typeof e!="object"||!("tool_calls"in e)||typeof e.tool_calls!="object"||e.tool_calls==null||!Array.isArray(e.tool_calls)||e.tool_calls.some(t=>t==null||typeof t!="object"||!("id"in t)||typeof t.id!="string"||!("type"in t)||typeof t.type!="string"||!("function"in t)||t.function==null||typeof t.function!="object"||!("arguments"in t.function)||typeof t.function.name!="string"||typeof t.function.arguments!="string"))throw new Error('"tool_calls" parts expect an object with a ToolCallPayload.');return{type:"tool_calls",value:e}}},ot={code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw new Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},it={code:"9",name:"tool_call",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string"||!("args"in e)||typeof e.args!="object")throw new Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},lt={code:"a",name:"tool_result",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("result"in e))throw new Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},ut={code:"b",name:"tool_call_streaming_start",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string")throw new Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},ct={code:"c",name:"tool_call_delta",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("argsTextDelta"in e)||typeof e.argsTextDelta!="string")throw new Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},dt={code:"d",name:"finish_message",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_message" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},pt={code:"e",name:"finish_step",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_step" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&typeof e.isContinued=="boolean"&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},sr=[Xe,Qe,et,tt,nt,rt,at,st,ot,it,lt,ut,ct,dt,pt],_s={[Xe.code]:Xe,[Qe.code]:Qe,[et.code]:et,[tt.code]:tt,[nt.code]:nt,[rt.code]:rt,[at.code]:at,[st.code]:st,[ot.code]:ot,[it.code]:it,[lt.code]:lt,[ut.code]:ut,[ct.code]:ct,[dt.code]:dt,[pt.code]:pt};Xe.name+"",Xe.code,Qe.name+"",Qe.code,et.name+"",et.code,tt.name+"",tt.code,nt.name+"",nt.code,rt.name+"",rt.code,at.name+"",at.code,st.name+"",st.code,ot.name+"",ot.code,it.name+"",it.code,lt.name+"",lt.code,ut.name+"",ut.code,ct.name+"",ct.code,dt.name+"",dt.code,pt.name+"",pt.code;var vs=sr.map(e=>e.code),bs=e=>{const t=e.indexOf(":");if(t===-1)throw new Error("Failed to parse stream string. No separator found.");const n=e.slice(0,t);if(!vs.includes(n))throw new Error(`Failed to parse stream string. Invalid code ${n}.`);const r=n,a=e.slice(t+1),s=JSON.parse(a);return _s[r].parse(s)};function W(e,t){const n=sr.find(r=>r.name===e);if(!n)throw new Error(`Invalid stream part type: ${e}`);return`${n.code}:${JSON.stringify(t)}
`}var ws=10;function Ss(e,t){const n=new Uint8Array(t);let r=0;for(const a of e)n.set(a,r),r+=a.length;return e.length=0,n}async function*Ts(e,{isAborted:t}={}){const n=new TextDecoder,r=[];let a=0;for(;;){const{value:s}=await e.read();if(s&&(r.push(s),a+=s.length,s[s.length-1]!==ws))continue;if(r.length===0)break;const o=Ss(r,a);a=0;const i=n.decode(o,{stream:!0}).split(`
`).filter(u=>u!=="").map(bs);for(const u of i)yield u;if(t!=null&&t()){e.cancel();break}}}function vt(e,t){return!e||!t||!t.length?e:{...e,annotations:[...t]}}async function Nl({reader:e,abortControllerRef:t,update:n,onToolCall:r,onFinish:a,generateId:s=Xn,getCurrentDate:o=()=>new Date}){var i;const u=o();let l={},c;const d=[],f=[];let y;const p={};let v={completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},T="unknown";for await(const{type:h,value:m}of Ts(e,{isAborted:()=>(t==null?void 0:t.current)===null})){if(h==="error")throw new Error(m);if(h==="finish_step"){m.isContinued||(c={});continue}if(h==="finish_message"){if(T=m.finishReason,m.usage!=null){const{completionTokens:b,promptTokens:k}=m.usage;v={completionTokens:b,promptTokens:k,totalTokens:b+k}}continue}if(c!=null&&(h==="text"||h==="tool_call"||h==="tool_call_streaming_start"||h==="tool_call_delta"||h==="tool_result")&&(l.text&&d.push(l.text),l.function_call&&d.push(l.function_call),l.tool_calls&&d.push(l.tool_calls),l=c,c=void 0),h==="text"&&(l.text?l.text={...l.text,content:(l.text.content||"")+m}:l.text={id:s(),role:"assistant",content:m,createdAt:u}),h==="tool_call_streaming_start")l.text==null&&(l.text={id:s(),role:"assistant",content:"",createdAt:u}),l.text.toolInvocations==null&&(l.text.toolInvocations=[]),p[m.toolCallId]={text:"",toolName:m.toolName,prefixMapIndex:l.text.toolInvocations.length},l.text.toolInvocations.push({state:"partial-call",toolCallId:m.toolCallId,toolName:m.toolName,args:void 0});else if(h==="tool_call_delta"){const b=p[m.toolCallId];b.text+=m.argsTextDelta;const{value:k}=ar(b.text);l.text.toolInvocations[b.prefixMapIndex]={state:"partial-call",toolCallId:m.toolCallId,toolName:b.toolName,args:k},l.text.internalUpdateId=s()}else if(h==="tool_call"){if(p[m.toolCallId]!=null?l.text.toolInvocations[p[m.toolCallId].prefixMapIndex]={state:"call",...m}:(l.text==null&&(l.text={id:s(),role:"assistant",content:"",createdAt:u}),l.text.toolInvocations==null&&(l.text.toolInvocations=[]),l.text.toolInvocations.push({state:"call",...m})),l.text.internalUpdateId=s(),r){const b=await r({toolCall:m});b!=null&&(l.text.toolInvocations[l.text.toolInvocations.length-1]={state:"result",...m,result:b})}}else if(h==="tool_result"){const b=(i=l.text)==null?void 0:i.toolInvocations;if(b==null)throw new Error("tool_result must be preceded by a tool_call");const k=b.findIndex(G=>G.toolCallId===m.toolCallId);if(k===-1)throw new Error("tool_result must be preceded by a tool_call with the same toolCallId");b[k]={...b[k],state:"result",...m}}let w=null;h==="function_call"&&(l.function_call={id:s(),role:"assistant",content:"",function_call:m.function_call,name:m.function_call.name,createdAt:u},w=l.function_call);let S=null;h==="tool_calls"&&(l.tool_calls={id:s(),role:"assistant",content:"",tool_calls:m.tool_calls,createdAt:u},S=l.tool_calls),h==="data"&&f.push(...m);let R=l.text;h==="message_annotations"&&(y?y.push(...m):y=[...m],w=vt(l.function_call,y),S=vt(l.tool_calls,y),R=vt(l.text,y),l.text!=null&&(l.text.internalUpdateId=s())),y!=null&&y.length&&(l.text&&(l.text.annotations=[...y]),l.function_call&&(l.function_call.annotations=[...y]),l.tool_calls&&(l.tool_calls.annotations=[...y]));const A=[w,S,R].filter(Boolean).map(b=>({...vt(b,y)}));n([...d,...A],[...f])}return a==null||a({message:l.text,finishReason:T,usage:v}),{messages:[l.text,l.function_call,l.tool_calls].filter(Boolean),data:f}}function xs(e){const t=new TextDecoder;return function(n){return n?t.decode(n,{stream:!0}):""}}function St(e,t){if(e===t)return!0;if(e==null||t==null)return!1;if(typeof e!="object"&&typeof t!="object")return e===t;if(e.constructor!==t.constructor)return!1;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(Array.isArray(e)){if(e.length!==t.length)return!1;for(let a=0;a<e.length;a++)if(!St(e[a],t[a]))return!1;return!0}const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const a of n)if(!r.includes(a)||!St(e[a],t[a]))return!1;return!0}var Lt=Symbol.for("vercel.ai.schema");function Is(e,{validate:t}={}){return{[Lt]:!0,_type:void 0,[Na]:!0,jsonSchema:e,validate:t}}function Es(e){return typeof e=="object"&&e!==null&&Lt in e&&e[Lt]===!0&&"jsonSchema"in e&&"validate"in e}function Tt(e){return Es(e)?e:As(e)}function As(e){return Is(hs(e),{validate:t=>{const n=e.safeParse(t);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}}})}var or="vercel.ai.error",ks=Symbol.for(or),ir,Rs=class lr extends Error{constructor({name:t,message:n,cause:r}){super(n),this[ir]=!0,this.name=t,this.cause=r}static isInstance(t){return lr.hasMarker(t,or)}static hasMarker(t,n){const r=Symbol.for(n);return t!=null&&typeof t=="object"&&r in t&&typeof t[r]=="boolean"&&t[r]===!0}toJSON(){return{name:this.name,message:this.message}}};ir=ks;var I=Rs,Bt="AI_APICallError",ur=`vercel.ai.error.${Bt}`,Ns=Symbol.for(ur),cr,Cs=class extends I{constructor({message:e,url:t,requestBodyValues:n,statusCode:r,responseHeaders:a,responseBody:s,cause:o,isRetryable:i=r!=null&&(r===408||r===409||r===429||r>=500),data:u}){super({name:Bt,message:e,cause:o}),this[cr]=!0,this.url=t,this.requestBodyValues=n,this.statusCode=r,this.responseHeaders=a,this.responseBody=s,this.isRetryable=i,this.data=u}static isInstance(e){return I.hasMarker(e,ur)}static isAPICallError(e){return e instanceof Error&&e.name===Bt&&typeof e.url=="string"&&typeof e.requestBodyValues=="object"&&(e.statusCode==null||typeof e.statusCode=="number")&&(e.responseHeaders==null||typeof e.responseHeaders=="object")&&(e.responseBody==null||typeof e.responseBody=="string")&&(e.cause==null||typeof e.cause=="object")&&typeof e.isRetryable=="boolean"&&(e.data==null||typeof e.data=="object")}toJSON(){return{name:this.name,message:this.message,url:this.url,requestBodyValues:this.requestBodyValues,statusCode:this.statusCode,responseHeaders:this.responseHeaders,responseBody:this.responseBody,cause:this.cause,isRetryable:this.isRetryable,data:this.data}}};cr=Ns;var Zt="AI_EmptyResponseBodyError",dr=`vercel.ai.error.${Zt}`,Os=Symbol.for(dr),pr,Cl=class extends I{constructor({message:e="Empty response body"}={}){super({name:Zt,message:e}),this[pr]=!0}static isInstance(e){return I.hasMarker(e,dr)}static isEmptyResponseBodyError(e){return e instanceof Error&&e.name===Zt}};pr=Os;function yn(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var fr="AI_InvalidArgumentError",mr=`vercel.ai.error.${fr}`,Ms=Symbol.for(mr),gr,Ps=class extends I{constructor({message:t,cause:n,argument:r}){super({name:fr,message:t,cause:n}),this[gr]=!0,this.argument=r}static isInstance(t){return I.hasMarker(t,mr)}};gr=Ms;var Vt="AI_InvalidPromptError",hr=`vercel.ai.error.${Vt}`,js=Symbol.for(hr),yr,De=class extends I{constructor({prompt:e,message:t,cause:n}){super({name:Vt,message:`Invalid prompt: ${t}`,cause:n}),this[yr]=!0,this.prompt=e}static isInstance(e){return I.hasMarker(e,hr)}static isInvalidPromptError(e){return e instanceof Error&&e.name===Vt&&prompt!=null}toJSON(){return{name:this.name,message:this.message,stack:this.stack,prompt:this.prompt}}};yr=js;var Gt="AI_InvalidResponseDataError",_r=`vercel.ai.error.${Gt}`,Ds=Symbol.for(_r),vr,Ml=class extends I{constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:Gt,message:t}),this[vr]=!0,this.data=e}static isInstance(e){return I.hasMarker(e,_r)}static isInvalidResponseDataError(e){return e instanceof Error&&e.name===Gt&&e.data!=null}toJSON(){return{name:this.name,message:this.message,stack:this.stack,data:this.data}}};vr=Ds;var zt="AI_JSONParseError",br=`vercel.ai.error.${zt}`,$s=Symbol.for(br),wr,On=class extends I{constructor({text:e,cause:t}){super({name:zt,message:`JSON parsing failed: Text: ${e}.
Error message: ${yn(t)}`,cause:t}),this[wr]=!0,this.text=e}static isInstance(e){return I.hasMarker(e,br)}static isJSONParseError(e){return e instanceof Error&&e.name===zt&&"text"in e&&typeof e.text=="string"}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,valueText:this.text}}};wr=$s;var Wt="AI_LoadAPIKeyError",Sr=`vercel.ai.error.${Wt}`,qs=Symbol.for(Sr),Tr,Pl=class extends I{constructor({message:e}){super({name:Wt,message:e}),this[Tr]=!0}static isInstance(e){return I.hasMarker(e,Sr)}static isLoadAPIKeyError(e){return e instanceof Error&&e.name===Wt}};Tr=qs;var Kt="AI_NoContentGeneratedError",xr=`vercel.ai.error.${Kt}`,Fs=Symbol.for(xr),Ir,jl=class extends I{constructor({message:e="No content generated."}={}){super({name:Kt,message:e}),this[Ir]=!0}static isInstance(e){return I.hasMarker(e,xr)}static isNoContentGeneratedError(e){return e instanceof Error&&e.name===Kt}toJSON(){return{name:this.name,cause:this.cause,message:this.message,stack:this.stack}}};Ir=Fs;var Yt="AI_NoSuchModelError",Er=`vercel.ai.error.${Yt}`,Us=Symbol.for(Er),Ar,$e=class extends I{constructor({errorName:e=Yt,modelId:t,modelType:n,message:r=`No such ${n}: ${t}`}){super({name:e,message:r}),this[Ar]=!0,this.modelId=t,this.modelType=n}static isInstance(e){return I.hasMarker(e,Er)}static isNoSuchModelError(e){return e instanceof Error&&e.name===Yt&&typeof e.modelId=="string"&&typeof e.modelType=="string"}toJSON(){return{name:this.name,message:this.message,stack:this.stack,modelId:this.modelId,modelType:this.modelType}}};Ar=Us;var Ht="AI_TypeValidationError",kr=`vercel.ai.error.${Ht}`,Js=Symbol.for(kr),Rr,Ls=class Xt extends I{constructor({value:t,cause:n}){super({name:Ht,message:`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${yn(n)}`,cause:n}),this[Rr]=!0,this.value=t}static isInstance(t){return I.hasMarker(t,kr)}static wrap({value:t,cause:n}){return Xt.isInstance(n)&&n.value===t?n:new Xt({value:t,cause:n})}static isTypeValidationError(t){return t instanceof Error&&t.name===Ht}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,value:this.value}}};Rr=Js;var Fe=Ls,Qt="AI_UnsupportedFunctionalityError",Nr=`vercel.ai.error.${Qt}`,Bs=Symbol.for(Nr),Cr,xt=class extends I{constructor({functionality:e}){super({name:Qt,message:`'${e}' functionality not supported.`}),this[Cr]=!0,this.functionality=e}static isInstance(e){return I.hasMarker(e,Nr)}static isUnsupportedFunctionalityError(e){return e instanceof Error&&e.name===Qt&&typeof e.functionality=="string"}toJSON(){return{name:this.name,message:this.message,stack:this.stack,functionality:this.functionality}}};Cr=Bs;function It(e){return e===null||typeof e=="string"||typeof e=="number"||typeof e=="boolean"?!0:Array.isArray(e)?e.every(It):typeof e=="object"?Object.entries(e).every(([t,n])=>typeof t=="string"&&It(n)):!1}function Mn(e){return Array.isArray(e)&&e.every(It)}function en(e){return e!=null&&typeof e=="object"&&Object.entries(e).every(([t,n])=>typeof t=="string"&&It(n))}let Zs=(e,t=21)=>(n=t)=>{let r="",a=n|0;for(;a--;)r+=e[Math.random()*e.length|0];return r};var ht=({prefix:e,size:t=7,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{const a=Zs(n,t);if(e==null)return a;if(n.includes(r))throw new Ps({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${n}".`});return s=>`${e}${r}${a(s)}`},Or=ht();function Vs(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}function Gs(e){return e instanceof Error&&(e.name==="AbortError"||e.name==="TimeoutError")}var tn=Symbol.for("vercel.ai.validator");function zs(e){return{[tn]:!0,validate:e}}function Ws(e){return typeof e=="object"&&e!==null&&tn in e&&e[tn]===!0&&"validate"in e}function Ks(e){return Ws(e)?e:Ys(e)}function Ys(e){return zs(t=>{const n=e.safeParse(t);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}})}function Ue({value:e,schema:t}){const n=Ks(t);try{if(n.validate==null)return{success:!0,value:e};const r=n.validate(e);return r.success?r:{success:!1,error:Fe.wrap({value:e,cause:r.error})}}catch(r){return{success:!1,error:Fe.wrap({value:e,cause:r})}}}function Mr({text:e,schema:t}){try{const n=Jt.parse(e);return t==null?{success:!0,value:n}:Ue({value:n,schema:t})}catch(n){return{success:!1,error:On.isJSONParseError(n)?n:new On({text:e,cause:n})}}}var{btoa:Hs,atob:Xs}=globalThis;function Qs(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n=Xs(t);return Uint8Array.from(n,r=>r.codePointAt(0))}function Pn(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCodePoint(e[n]);return Hs(t)}var eo=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},Re="1.9.0",jn=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function to(e){var t=new Set([e]),n=new Set,r=e.match(jn);if(!r)return function(){return!1};var a={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};if(a.prerelease!=null)return function(u){return u===e};function s(i){return n.add(i),!1}function o(i){return t.add(i),!0}return function(u){if(t.has(u))return!0;if(n.has(u))return!1;var l=u.match(jn);if(!l)return s(u);var c={major:+l[1],minor:+l[2],patch:+l[3],prerelease:l[4]};return c.prerelease!=null||a.major!==c.major?s(u):a.major===0?a.minor===c.minor&&a.patch<=c.patch?o(u):s(u):a.minor<=c.minor?o(u):s(u)}}var no=to(Re),ro=Re.split(".")[0],ft=Symbol.for("opentelemetry.js.api."+ro),mt=eo;function _n(e,t,n,r){var a;r===void 0&&(r=!1);var s=mt[ft]=(a=mt[ft])!==null&&a!==void 0?a:{version:Re};if(!r&&s[e]){var o=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return n.error(o.stack||o.message),!1}if(s.version!==Re){var o=new Error("@opentelemetry/api: Registration of version v"+s.version+" for "+e+" does not match previously registered API v"+Re);return n.error(o.stack||o.message),!1}return s[e]=t,n.debug("@opentelemetry/api: Registered a global for "+e+" v"+Re+"."),!0}function gt(e){var t,n,r=(t=mt[ft])===null||t===void 0?void 0:t.version;if(!(!r||!no(r)))return(n=mt[ft])===null||n===void 0?void 0:n[e]}function vn(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+Re+".");var n=mt[ft];n&&delete n[e]}var ao=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),a,s=[],o;try{for(;(t===void 0||t-- >0)&&!(a=r.next()).done;)s.push(a.value)}catch(i){o={error:i}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},so=function(e,t,n){if(n||arguments.length===2)for(var r=0,a=t.length,s;r<a;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))},oo=function(){function e(t){this._namespace=t.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Ye("debug",this._namespace,t)},e.prototype.error=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Ye("error",this._namespace,t)},e.prototype.info=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Ye("info",this._namespace,t)},e.prototype.warn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Ye("warn",this._namespace,t)},e.prototype.verbose=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Ye("verbose",this._namespace,t)},e}();function Ye(e,t,n){var r=gt("diag");if(r)return n.unshift(t),r[e].apply(r,so([],ao(n),!1))}var ye;(function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"})(ye||(ye={}));function io(e,t){e<ye.NONE?e=ye.NONE:e>ye.ALL&&(e=ye.ALL),t=t||{};function n(r,a){var s=t[r];return typeof s=="function"&&e>=a?s.bind(t):function(){}}return{error:n("error",ye.ERROR),warn:n("warn",ye.WARN),info:n("info",ye.INFO),debug:n("debug",ye.DEBUG),verbose:n("verbose",ye.VERBOSE)}}var lo=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),a,s=[],o;try{for(;(t===void 0||t-- >0)&&!(a=r.next()).done;)s.push(a.value)}catch(i){o={error:i}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},uo=function(e,t,n){if(n||arguments.length===2)for(var r=0,a=t.length,s;r<a;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))},co="diag",Et=function(){function e(){function t(a){return function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var i=gt("diag");if(i)return i[a].apply(i,uo([],lo(s),!1))}}var n=this,r=function(a,s){var o,i,u;if(s===void 0&&(s={logLevel:ye.INFO}),a===n){var l=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return n.error((o=l.stack)!==null&&o!==void 0?o:l.message),!1}typeof s=="number"&&(s={logLevel:s});var c=gt("diag"),d=io((i=s.logLevel)!==null&&i!==void 0?i:ye.INFO,a);if(c&&!s.suppressOverrideMessage){var f=(u=new Error().stack)!==null&&u!==void 0?u:"<failed to generate stacktrace>";c.warn("Current logger will be overwritten from "+f),d.warn("Current logger will overwrite one already registered from "+f)}return _n("diag",d,n,!0)};n.setLogger=r,n.disable=function(){vn(co,n)},n.createComponentLogger=function(a){return new oo(a)},n.verbose=t("verbose"),n.debug=t("debug"),n.info=t("info"),n.warn=t("warn"),n.error=t("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}();function po(e){return Symbol.for(e)}var fo=function(){function e(t){var n=this;n._currentContext=t?new Map(t):new Map,n.getValue=function(r){return n._currentContext.get(r)},n.setValue=function(r,a){var s=new e(n._currentContext);return s._currentContext.set(r,a),s},n.deleteValue=function(r){var a=new e(n._currentContext);return a._currentContext.delete(r),a}}return e}(),mo=new fo,go=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),a,s=[],o;try{for(;(t===void 0||t-- >0)&&!(a=r.next()).done;)s.push(a.value)}catch(i){o={error:i}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},ho=function(e,t,n){if(n||arguments.length===2)for(var r=0,a=t.length,s;r<a;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))},yo=function(){function e(){}return e.prototype.active=function(){return mo},e.prototype.with=function(t,n,r){for(var a=[],s=3;s<arguments.length;s++)a[s-3]=arguments[s];return n.call.apply(n,ho([r],go(a),!1))},e.prototype.bind=function(t,n){return n},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),_o=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),a,s=[],o;try{for(;(t===void 0||t-- >0)&&!(a=r.next()).done;)s.push(a.value)}catch(i){o={error:i}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},vo=function(e,t,n){if(n||arguments.length===2)for(var r=0,a=t.length,s;r<a;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))},$t="context",bo=new yo,Pr=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(t){return _n($t,t,Et.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(t,n,r){for(var a,s=[],o=3;o<arguments.length;o++)s[o-3]=arguments[o];return(a=this._getContextManager()).with.apply(a,vo([t,n,r],_o(s),!1))},e.prototype.bind=function(t,n){return this._getContextManager().bind(t,n)},e.prototype._getContextManager=function(){return gt($t)||bo},e.prototype.disable=function(){this._getContextManager().disable(),vn($t,Et.instance())},e}(),nn;(function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"})(nn||(nn={}));var jr="0000000000000000",Dr="00000000000000000000000000000000",wo={traceId:Dr,spanId:jr,traceFlags:nn.NONE},He=function(){function e(t){t===void 0&&(t=wo),this._spanContext=t}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(t,n){return this},e.prototype.setAttributes=function(t){return this},e.prototype.addEvent=function(t,n){return this},e.prototype.addLink=function(t){return this},e.prototype.addLinks=function(t){return this},e.prototype.setStatus=function(t){return this},e.prototype.updateName=function(t){return this},e.prototype.end=function(t){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(t,n){},e}(),bn=po("OpenTelemetry Context Key SPAN");function wn(e){return e.getValue(bn)||void 0}function So(){return wn(Pr.getInstance().active())}function Sn(e,t){return e.setValue(bn,t)}function To(e){return e.deleteValue(bn)}function xo(e,t){return Sn(e,new He(t))}function $r(e){var t;return(t=wn(e))===null||t===void 0?void 0:t.spanContext()}var Io=/^([0-9a-f]{32})$/i,Eo=/^[0-9a-f]{16}$/i;function Ao(e){return Io.test(e)&&e!==Dr}function ko(e){return Eo.test(e)&&e!==jr}function qr(e){return Ao(e.traceId)&&ko(e.spanId)}function Ro(e){return new He(e)}var qt=Pr.getInstance(),Fr=function(){function e(){}return e.prototype.startSpan=function(t,n,r){r===void 0&&(r=qt.active());var a=!!(n!=null&&n.root);if(a)return new He;var s=r&&$r(r);return No(s)&&qr(s)?new He(s):new He},e.prototype.startActiveSpan=function(t,n,r,a){var s,o,i;if(!(arguments.length<2)){arguments.length===2?i=n:arguments.length===3?(s=n,i=r):(s=n,o=r,i=a);var u=o??qt.active(),l=this.startSpan(t,s,u),c=Sn(u,l);return qt.with(c,i,void 0,l)}},e}();function No(e){return typeof e=="object"&&typeof e.spanId=="string"&&typeof e.traceId=="string"&&typeof e.traceFlags=="number"}var Co=new Fr,Oo=function(){function e(t,n,r,a){this._provider=t,this.name=n,this.version=r,this.options=a}return e.prototype.startSpan=function(t,n,r){return this._getTracer().startSpan(t,n,r)},e.prototype.startActiveSpan=function(t,n,r,a){var s=this._getTracer();return Reflect.apply(s.startActiveSpan,s,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var t=this._provider.getDelegateTracer(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):Co},e}(),Mo=function(){function e(){}return e.prototype.getTracer=function(t,n,r){return new Fr},e}(),Po=new Mo,Dn=function(){function e(){}return e.prototype.getTracer=function(t,n,r){var a;return(a=this.getDelegateTracer(t,n,r))!==null&&a!==void 0?a:new Oo(this,t,n,r)},e.prototype.getDelegate=function(){var t;return(t=this._delegate)!==null&&t!==void 0?t:Po},e.prototype.setDelegate=function(t){this._delegate=t},e.prototype.getDelegateTracer=function(t,n,r){var a;return(a=this._delegate)===null||a===void 0?void 0:a.getTracer(t,n,r)},e}(),At;(function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"})(At||(At={}));var Ft="trace",jo=function(){function e(){this._proxyTracerProvider=new Dn,this.wrapSpanContext=Ro,this.isSpanContextValid=qr,this.deleteSpan=To,this.getSpan=wn,this.getActiveSpan=So,this.getSpanContext=$r,this.setSpan=Sn,this.setSpanContext=xo}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(t){var n=_n(Ft,this._proxyTracerProvider,Et.instance());return n&&this._proxyTracerProvider.setDelegate(t),n},e.prototype.getTracerProvider=function(){return gt(Ft)||this._proxyTracerProvider},e.prototype.getTracer=function(t,n){return this.getTracerProvider().getTracer(t,n)},e.prototype.disable=function(){vn(Ft,Et.instance()),this._proxyTracerProvider=new Dn},e}(),Do=jo.getInstance(),$o=Object.defineProperty,Ur=(e,t)=>{for(var n in t)$o(e,n,{get:t[n],enumerable:!0})};async function qo(e){return e===void 0?Promise.resolve():new Promise(t=>setTimeout(t,e))}var rn="AI_RetryError",Jr=`vercel.ai.error.${rn}`,Fo=Symbol.for(Jr),Lr,$n=class extends I{constructor({message:e,reason:t,errors:n}){super({name:rn,message:e}),this[Lr]=!0,this.reason=t,this.errors=n,this.lastError=n[n.length-1]}static isInstance(e){return I.hasMarker(e,Jr)}static isRetryError(e){return e instanceof Error&&e.name===rn&&typeof e.reason=="string"&&Array.isArray(e.errors)}toJSON(){return{name:this.name,message:this.message,reason:this.reason,lastError:this.lastError,errors:this.errors}}};Lr=Fo;var Ze=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:n=2}={})=>async r=>Br(r,{maxRetries:e,delayInMs:t,backoffFactor:n});async function Br(e,{maxRetries:t,delayInMs:n,backoffFactor:r},a=[]){try{return await e()}catch(s){if(Gs(s)||t===0)throw s;const o=Vs(s),i=[...a,s],u=i.length;if(u>t)throw new $n({message:`Failed after ${u} attempts. Last error: ${o}`,reason:"maxRetriesExceeded",errors:i});if(s instanceof Error&&Cs.isAPICallError(s)&&s.isRetryable===!0&&u<=t)return await qo(n),Br(e,{maxRetries:t,delayInMs:r*n,backoffFactor:r},i);throw u===1?s:new $n({message:`Failed after ${u} attempts with non-retryable error: '${o}'`,reason:"errorNotRetryable",errors:i})}}function se({operationId:e,telemetry:t}){return{"operation.name":`${e}${(t==null?void 0:t.functionId)!=null?` ${t.functionId}`:""}`,"resource.name":t==null?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":t==null?void 0:t.functionId}}function Ve({model:e,settings:t,telemetry:n,headers:r}){var a;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((s,[o,i])=>(s[`ai.settings.${o}`]=i,s),{}),...Object.entries((a=n==null?void 0:n.metadata)!=null?a:{}).reduce((s,[o,i])=>(s[`ai.telemetry.metadata.${o}`]=i,s),{}),...Object.entries(r??{}).reduce((s,[o,i])=>(i!==void 0&&(s[`ai.request.headers.${o}`]=i),s),{})}}var Uo={startSpan(){return bt},startActiveSpan(e,t,n,r){if(typeof t=="function")return t(bt);if(typeof n=="function")return n(bt);if(typeof r=="function")return r(bt)}},bt={spanContext(){return Jo},setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording(){return!1},recordException(){return this}},Jo={traceId:"",spanId:"",traceFlags:0};function Ge({isEnabled:e=!1,tracer:t}={}){return e?t||Do.getTracer("ai"):Uo}function oe({name:e,tracer:t,attributes:n,fn:r,endWhenDone:a=!0}){return t.startActiveSpan(e,{attributes:n},async s=>{try{const o=await r(s);return a&&s.end(),o}catch(o){try{o instanceof Error?(s.recordException({name:o.name,message:o.message,stack:o.stack}),s.setStatus({code:At.ERROR,message:o.message})):s.setStatus({code:At.ERROR})}finally{s.end()}throw o}})}function N({telemetry:e,attributes:t}){return(e==null?void 0:e.isEnabled)!==!0?{}:Object.entries(t).reduce((n,[r,a])=>{if(a===void 0)return n;if(typeof a=="object"&&"input"in a&&typeof a.input=="function"){if((e==null?void 0:e.recordInputs)===!1)return n;const s=a.input();return s===void 0?n:{...n,[r]:s}}if(typeof a=="object"&&"output"in a&&typeof a.output=="function"){if((e==null?void 0:e.recordOutputs)===!1)return n;const s=a.output();return s===void 0?n:{...n,[r]:s}}return{...n,[r]:a}},{})}async function Dl({model:e,value:t,maxRetries:n,abortSignal:r,headers:a,experimental_telemetry:s}){const o=Ve({model:e,telemetry:s,headers:a,settings:{maxRetries:n}}),i=Ge(s);return oe({name:"ai.embed",attributes:N({telemetry:s,attributes:{...se({operationId:"ai.embed",telemetry:s}),...o,"ai.value":{input:()=>JSON.stringify(t)}}}),tracer:i,fn:async u=>{const l=Ze({maxRetries:n}),{embedding:c,usage:d,rawResponse:f}=await l(()=>oe({name:"ai.embed.doEmbed",attributes:N({telemetry:s,attributes:{...se({operationId:"ai.embed.doEmbed",telemetry:s}),...o,"ai.values":{input:()=>[JSON.stringify(t)]}}}),tracer:i,fn:async y=>{var p;const v=await e.doEmbed({values:[t],abortSignal:r,headers:a}),T=v.embeddings[0],h=(p=v.usage)!=null?p:{tokens:NaN};return y.setAttributes(N({telemetry:s,attributes:{"ai.embeddings":{output:()=>v.embeddings.map(m=>JSON.stringify(m))},"ai.usage.tokens":h.tokens}})),{embedding:T,usage:h,rawResponse:v.rawResponse}}}));return u.setAttributes(N({telemetry:s,attributes:{"ai.embedding":{output:()=>JSON.stringify(c)},"ai.usage.tokens":d.tokens}})),new Lo({value:t,embedding:c,usage:d,rawResponse:f})}})}var Lo=class{constructor(e){this.value=e.value,this.embedding=e.embedding,this.usage=e.usage,this.rawResponse=e.rawResponse}};function Bo(e,t){if(t<=0)throw new Error("chunkSize must be greater than 0");const n=[];for(let r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n}async function $l({model:e,values:t,maxRetries:n,abortSignal:r,headers:a,experimental_telemetry:s}){const o=Ve({model:e,telemetry:s,headers:a,settings:{maxRetries:n}}),i=Ge(s);return oe({name:"ai.embedMany",attributes:N({telemetry:s,attributes:{...se({operationId:"ai.embedMany",telemetry:s}),...o,"ai.values":{input:()=>t.map(u=>JSON.stringify(u))}}}),tracer:i,fn:async u=>{const l=Ze({maxRetries:n}),c=e.maxEmbeddingsPerCall;if(c==null){const{embeddings:p,usage:v}=await l(()=>oe({name:"ai.embedMany.doEmbed",attributes:N({telemetry:s,attributes:{...se({operationId:"ai.embedMany.doEmbed",telemetry:s}),...o,"ai.values":{input:()=>t.map(T=>JSON.stringify(T))}}}),tracer:i,fn:async T=>{var h;const m=await e.doEmbed({values:t,abortSignal:r,headers:a}),w=m.embeddings,S=(h=m.usage)!=null?h:{tokens:NaN};return T.setAttributes(N({telemetry:s,attributes:{"ai.embeddings":{output:()=>w.map(R=>JSON.stringify(R))},"ai.usage.tokens":S.tokens}})),{embeddings:w,usage:S}}}));return u.setAttributes(N({telemetry:s,attributes:{"ai.embeddings":{output:()=>p.map(T=>JSON.stringify(T))},"ai.usage.tokens":v.tokens}})),new qn({values:t,embeddings:p,usage:v})}const d=Bo(t,c),f=[];let y=0;for(const p of d){const{embeddings:v,usage:T}=await l(()=>oe({name:"ai.embedMany.doEmbed",attributes:N({telemetry:s,attributes:{...se({operationId:"ai.embedMany.doEmbed",telemetry:s}),...o,"ai.values":{input:()=>p.map(h=>JSON.stringify(h))}}}),tracer:i,fn:async h=>{var m;const w=await e.doEmbed({values:p,abortSignal:r,headers:a}),S=w.embeddings,R=(m=w.usage)!=null?m:{tokens:NaN};return h.setAttributes(N({telemetry:s,attributes:{"ai.embeddings":{output:()=>S.map(A=>JSON.stringify(A))},"ai.usage.tokens":R.tokens}})),{embeddings:S,usage:R}}}));f.push(...v),y+=T.tokens}return u.setAttributes(N({telemetry:s,attributes:{"ai.embeddings":{output:()=>f.map(p=>JSON.stringify(p))},"ai.usage.tokens":y}})),new qn({values:t,embeddings:f,usage:{tokens:y}})}})}var qn=class{constructor(e){this.values=e.values,this.embeddings=e.embeddings,this.usage=e.usage}},an="AI_DownloadError",Zr=`vercel.ai.error.${an}`,Zo=Symbol.for(Zr),Vr,Ut=class extends I{constructor({url:e,statusCode:t,statusText:n,cause:r,message:a=r==null?`Failed to download ${e}: ${t} ${n}`:`Failed to download ${e}: ${r}`}){super({name:an,message:a,cause:r}),this[Vr]=!0,this.url=e,this.statusCode=t,this.statusText=n}static isInstance(e){return I.hasMarker(e,Zr)}static isDownloadError(e){return e instanceof Error&&e.name===an&&typeof e.url=="string"&&(e.statusCode==null||typeof e.statusCode=="number")&&(e.statusText==null||typeof e.statusText=="string")}toJSON(){return{name:this.name,message:this.message,url:this.url,statusCode:this.statusCode,statusText:this.statusText,cause:this.cause}}};Vr=Zo;async function Vo({url:e,fetchImplementation:t=fetch}){var n;const r=e.toString();try{const a=await t(r);if(!a.ok)throw new Ut({url:r,statusCode:a.status,statusText:a.statusText});return{data:new Uint8Array(await a.arrayBuffer()),mimeType:(n=a.headers.get("content-type"))!=null?n:void 0}}catch(a){throw Ut.isInstance(a)?a:new Ut({url:r,cause:a})}}var Go=[{mimeType:"image/gif",bytes:[71,73,70]},{mimeType:"image/png",bytes:[137,80,78,71]},{mimeType:"image/jpeg",bytes:[255,216]},{mimeType:"image/webp",bytes:[82,73,70,70]}];function zo(e){for(const{bytes:t,mimeType:n}of Go)if(e.length>=t.length&&t.every((r,a)=>e[a]===r))return n}var sn="AI_InvalidDataContentError",Gr=`vercel.ai.error.${sn}`,Wo=Symbol.for(Gr),zr,Fn=class extends I{constructor({content:e,cause:t,message:n=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:sn,message:n,cause:t}),this[zr]=!0,this.content=e}static isInstance(e){return I.hasMarker(e,Gr)}static isInvalidDataContentError(e){return e instanceof Error&&e.name===sn&&e.content!=null}toJSON(){return{name:this.name,message:this.message,stack:this.stack,cause:this.cause,content:this.content}}};zr=Wo;var Wr=g.union([g.string(),g.instanceof(Uint8Array),g.instanceof(ArrayBuffer),g.custom(e=>{var t,n;return(n=(t=globalThis.Buffer)==null?void 0:t.isBuffer(e))!=null?n:!1},{message:"Must be a Buffer"})]);function Ko(e){return typeof e=="string"?e:e instanceof ArrayBuffer?Pn(new Uint8Array(e)):Pn(e)}function kt(e){if(e instanceof Uint8Array)return e;if(typeof e=="string")try{return Qs(e)}catch(t){throw new Fn({message:"Invalid data content. Content string is not a base64-encoded media.",content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new Fn({content:e})}function Yo(e){try{return new TextDecoder().decode(e)}catch{throw new Error("Error decoding Uint8Array to text")}}var on="AI_InvalidMessageRoleError",Kr=`vercel.ai.error.${on}`,Ho=Symbol.for(Kr),Yr,Xo=class extends I{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:on,message:t}),this[Yr]=!0,this.role=e}static isInstance(e){return I.hasMarker(e,Kr)}static isInvalidMessageRoleError(e){return e instanceof Error&&e.name===on&&typeof e.role=="string"}toJSON(){return{name:this.name,message:this.message,stack:this.stack,role:this.role}}};Yr=Ho;function Qo(e){try{const[t,n]=e.split(",");return{mimeType:t.split(";")[0].split(":")[1],base64Content:n}}catch{return{mimeType:void 0,base64Content:void 0}}}async function Je({prompt:e,modelSupportsImageUrls:t=!0,modelSupportsUrl:n=()=>!1,downloadImplementation:r=Vo}){const a=await ti(e.messages,r,t,n);return[...e.system!=null?[{role:"system",content:e.system}]:[],...e.messages.map(s=>ei(s,a))]}function ei(e,t){const n=e.role;switch(n){case"system":return{role:"system",content:e.content,providerMetadata:e.experimental_providerMetadata};case"user":return typeof e.content=="string"?{role:"user",content:[{type:"text",text:e.content}],providerMetadata:e.experimental_providerMetadata}:{role:"user",content:e.content.map(r=>ni(r,t)).filter(r=>r.type!=="text"||r.text!==""),providerMetadata:e.experimental_providerMetadata};case"assistant":return typeof e.content=="string"?{role:"assistant",content:[{type:"text",text:e.content}],providerMetadata:e.experimental_providerMetadata}:{role:"assistant",content:e.content.filter(r=>r.type!=="text"||r.text!=="").map(r=>{const{experimental_providerMetadata:a,...s}=r;return{...s,providerMetadata:a}}),providerMetadata:e.experimental_providerMetadata};case"tool":return{role:"tool",content:e.content.map(r=>({type:"tool-result",toolCallId:r.toolCallId,toolName:r.toolName,result:r.result,content:r.experimental_content,isError:r.isError,providerMetadata:r.experimental_providerMetadata})),providerMetadata:e.experimental_providerMetadata};default:{const r=n;throw new Xo({role:r})}}}async function ti(e,t,n,r){const a=e.filter(o=>o.role==="user").map(o=>o.content).filter(o=>Array.isArray(o)).flat().filter(o=>o.type==="image"||o.type==="file").filter(o=>!(o.type==="image"&&n===!0)).map(o=>o.type==="image"?o.image:o.data).map(o=>typeof o=="string"&&(o.startsWith("http:")||o.startsWith("https:"))?new URL(o):o).filter(o=>o instanceof URL).filter(o=>!r(o)),s=await Promise.all(a.map(async o=>({url:o,data:await t({url:o})})));return Object.fromEntries(s.map(({url:o,data:i})=>[o.toString(),i]))}function ni(e,t){if(e.type==="text")return{type:"text",text:e.text,providerMetadata:e.experimental_providerMetadata};let n=e.mimeType,r,a,s;const o=e.type;switch(o){case"image":r=e.image;break;case"file":r=e.data;break;default:throw new Error(`Unsupported part type: ${o}`)}try{a=typeof r=="string"?new URL(r):r}catch{a=r}if(a instanceof URL)if(a.protocol==="data:"){const{mimeType:i,base64Content:u}=Qo(a.toString());if(i==null||u==null)throw new Error(`Invalid data URL format in part ${o}`);n=i,s=kt(u)}else{const i=t[a.toString()];i?(s=i.data,n??(n=i.mimeType)):s=a}else s=kt(a);switch(o){case"image":return n==null&&s instanceof Uint8Array&&(n=zo(s)),{type:"image",image:s,mimeType:n,providerMetadata:e.experimental_providerMetadata};case"file":if(n==null)throw new Error("Mime type is missing for file part");return{type:"file",data:s instanceof Uint8Array?Ko(s):s,mimeType:n,providerMetadata:e.experimental_providerMetadata}}}var ln="AI_InvalidArgumentError",Hr=`vercel.ai.error.${ln}`,ri=Symbol.for(Hr),Xr,F=class extends I{constructor({parameter:e,value:t,message:n}){super({name:ln,message:`Invalid argument for parameter ${e}: ${n}`}),this[Xr]=!0,this.parameter=e,this.value=t}static isInstance(e){return I.hasMarker(e,Hr)}static isInvalidArgumentError(e){return e instanceof Error&&e.name===ln&&typeof e.parameter=="string"&&typeof e.value=="string"}toJSON(){return{name:this.name,message:this.message,stack:this.stack,parameter:this.parameter,value:this.value}}};Xr=ri;function Le({maxTokens:e,temperature:t,topP:n,topK:r,presencePenalty:a,frequencyPenalty:s,stopSequences:o,seed:i,maxRetries:u}){if(e!=null){if(!Number.isInteger(e))throw new F({parameter:"maxTokens",value:e,message:"maxTokens must be an integer"});if(e<1)throw new F({parameter:"maxTokens",value:e,message:"maxTokens must be >= 1"})}if(t!=null&&typeof t!="number")throw new F({parameter:"temperature",value:t,message:"temperature must be a number"});if(n!=null&&typeof n!="number")throw new F({parameter:"topP",value:n,message:"topP must be a number"});if(r!=null&&typeof r!="number")throw new F({parameter:"topK",value:r,message:"topK must be a number"});if(a!=null&&typeof a!="number")throw new F({parameter:"presencePenalty",value:a,message:"presencePenalty must be a number"});if(s!=null&&typeof s!="number")throw new F({parameter:"frequencyPenalty",value:s,message:"frequencyPenalty must be a number"});if(i!=null&&!Number.isInteger(i))throw new F({parameter:"seed",value:i,message:"seed must be an integer"});if(u!=null){if(!Number.isInteger(u))throw new F({parameter:"maxRetries",value:u,message:"maxRetries must be an integer"});if(u<0)throw new F({parameter:"maxRetries",value:u,message:"maxRetries must be >= 0"})}return{maxTokens:e,temperature:t??0,topP:n,topK:r,presencePenalty:a,frequencyPenalty:s,stopSequences:o!=null&&o.length>0?o:void 0,seed:i,maxRetries:u??2}}var un=g.lazy(()=>g.union([g.null(),g.string(),g.number(),g.boolean(),g.record(g.string(),un),g.array(un)])),Ee=g.record(g.string(),g.record(g.string(),un)),ai=g.array(g.union([g.object({type:g.literal("text"),text:g.string()}),g.object({type:g.literal("image"),data:g.string(),mimeType:g.string().optional()})])),Qr=g.object({type:g.literal("text"),text:g.string(),experimental_providerMetadata:Ee.optional()}),si=g.object({type:g.literal("image"),image:g.union([Wr,g.instanceof(URL)]),mimeType:g.string().optional(),experimental_providerMetadata:Ee.optional()}),oi=g.object({type:g.literal("file"),data:g.union([Wr,g.instanceof(URL)]),mimeType:g.string(),experimental_providerMetadata:Ee.optional()}),ii=g.object({type:g.literal("tool-call"),toolCallId:g.string(),toolName:g.string(),args:g.unknown()}),li=g.object({type:g.literal("tool-result"),toolCallId:g.string(),toolName:g.string(),result:g.unknown(),content:ai.optional(),isError:g.boolean().optional(),experimental_providerMetadata:Ee.optional()}),ui=g.object({role:g.literal("system"),content:g.string(),experimental_providerMetadata:Ee.optional()}),ci=g.object({role:g.literal("user"),content:g.union([g.string(),g.array(g.union([Qr,si,oi]))]),experimental_providerMetadata:Ee.optional()}),di=g.object({role:g.literal("assistant"),content:g.union([g.string(),g.array(g.union([Qr,ii]))]),experimental_providerMetadata:Ee.optional()}),pi=g.object({role:g.literal("tool"),content:g.array(li),experimental_providerMetadata:Ee.optional()}),fi=g.union([ui,ci,di,pi]);function mi(e){if(!Array.isArray(e))return"other";if(e.length===0)return"messages";const t=e.map(gi);return t.some(n=>n==="has-ui-specific-parts")?"ui-messages":t.every(n=>n==="has-core-specific-parts"||n==="message")?"messages":"other"}function gi(e){return typeof e=="object"&&e!==null&&(e.role==="function"||e.role==="data"||"toolInvocations"in e||"experimental_attachments"in e)?"has-ui-specific-parts":typeof e=="object"&&e!==null&&"content"in e&&(Array.isArray(e.content)||"experimental_providerMetadata"in e)?"has-core-specific-parts":typeof e=="object"&&e!==null&&"role"in e&&"content"in e&&typeof e.content=="string"&&["system","user","assistant","tool"].includes(e.role)?"message":"other"}function hi(e){var t,n,r;const a=[];for(const s of e){let o;try{o=new URL(s.url)}catch{throw new Error(`Invalid URL: ${s.url}`)}switch(o.protocol){case"http:":case"https:":{if((t=s.contentType)!=null&&t.startsWith("image/"))a.push({type:"image",image:o});else{if(!s.contentType)throw new Error("If the attachment is not an image, it must specify a content type");a.push({type:"file",data:o,mimeType:s.contentType})}break}case"data:":{let i,u,l;try{[i,u]=s.url.split(","),l=i.split(";")[0].split(":")[1]}catch{throw new Error(`Error processing data URL: ${s.url}`)}if(l==null||u==null)throw new Error(`Invalid data URL format: ${s.url}`);if((n=s.contentType)!=null&&n.startsWith("image/"))a.push({type:"image",image:kt(u)});else if((r=s.contentType)!=null&&r.startsWith("text/"))a.push({type:"text",text:Yo(kt(u))});else{if(!s.contentType)throw new Error("If the attachment is not an image or text, it must specify a content type");a.push({type:"file",data:u,mimeType:s.contentType})}break}default:throw new Error(`Unsupported URL protocol: ${o.protocol}`)}}return a}var ea="AI_MessageConversionError",ta=`vercel.ai.error.${ea}`,yi=Symbol.for(ta),na,Un=class extends I{constructor({originalMessage:e,message:t}){super({name:ea,message:t}),this[na]=!0,this.originalMessage=e}static isInstance(e){return I.hasMarker(e,ta)}};na=yi;function _i(e,t){var n;const r=(n=t==null?void 0:t.tools)!=null?n:{},a=[];for(const s of e){const{role:o,content:i,toolInvocations:u,experimental_attachments:l}=s;switch(o){case"system":{a.push({role:"system",content:i});break}case"user":{a.push({role:"user",content:l?[{type:"text",text:i},...hi(l)]:i});break}case"assistant":{if(u==null){a.push({role:"assistant",content:i});break}a.push({role:"assistant",content:[{type:"text",text:i},...u.map(({toolCallId:c,toolName:d,args:f})=>({type:"tool-call",toolCallId:c,toolName:d,args:f}))]}),a.push({role:"tool",content:u.map(c=>{if(!("result"in c))throw new Un({originalMessage:s,message:"ToolInvocation must have a result: "+JSON.stringify(c)});const{toolCallId:d,toolName:f,result:y}=c,p=r[f];return(p==null?void 0:p.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:d,toolName:f,result:p.experimental_toToolResultContent(y),experimental_content:p.experimental_toToolResultContent(y)}:{type:"tool-result",toolCallId:d,toolName:f,result:y}})});break}case"function":case"data":case"tool":break;default:{const c=o;throw new Un({originalMessage:s,message:`Unsupported role: ${c}`})}}}return a}function Be({prompt:e,tools:t}){if(e.prompt==null&&e.messages==null)throw new De({prompt:e,message:"prompt or messages must be defined"});if(e.prompt!=null&&e.messages!=null)throw new De({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(e.system!=null&&typeof e.system!="string")throw new De({prompt:e,message:"system must be a string"});if(e.prompt!=null){if(typeof e.prompt!="string")throw new De({prompt:e,message:"prompt must be a string"});return{type:"prompt",system:e.system,messages:[{role:"user",content:e.prompt}]}}if(e.messages!=null){const n=mi(e.messages);if(n==="other")throw new De({prompt:e,message:"messages must be an array of CoreMessage or UIMessage"});const r=n==="ui-messages"?_i(e.messages,{tools:t}):e.messages,a=Ue({value:r,schema:g.array(fi)});if(!a.success)throw new De({prompt:e,message:"messages must be an array of CoreMessage or UIMessage",cause:a.error});return{type:"messages",messages:r,system:e.system}}throw new Error("unreachable")}function Ct(e){return{promptTokens:e.promptTokens,completionTokens:e.completionTokens,totalTokens:e.promptTokens+e.completionTokens}}function Ne(e,{contentType:t,dataStreamVersion:n}){var r;const a=new Headers((r=e==null?void 0:e.headers)!=null?r:{});return a.has("Content-Type")||a.set("Content-Type",t),n!==void 0&&a.set("X-Vercel-AI-Data-Stream",n),a}var vi="JSON schema:",bi="You MUST answer with a JSON object that matches the JSON schema above.",wi="You MUST answer with JSON.";function Rt({prompt:e,schema:t,schemaPrefix:n=t!=null?vi:void 0,schemaSuffix:r=t!=null?bi:wi}){return[e!=null&&e.length>0?e:void 0,e!=null&&e.length>0?"":void 0,n,t!=null?JSON.stringify(t):void 0,r].filter(a=>a!=null).join(`
`)}var cn="AI_NoObjectGeneratedError",ra=`vercel.ai.error.${cn}`,Si=Symbol.for(ra),aa,dn=class extends I{constructor({message:e="No object generated."}={}){super({name:cn,message:e}),this[aa]=!0}static isInstance(e){return I.hasMarker(e,ra)}static isNoObjectGeneratedError(e){return e instanceof Error&&e.name===cn}toJSON(){return{name:this.name,cause:this.cause,message:this.message,stack:this.stack}}};aa=Si;function qe(e,t){const n=e.pipeThrough(new TransformStream(t));return n[Symbol.asyncIterator]=()=>{const r=n.getReader();return{async next(){const{done:a,value:s}=await r.read();return a?{done:!0,value:void 0}:{done:!1,value:s}}}},n}var Ti={type:"no-schema",jsonSchema:void 0,validatePartialResult({value:e,textDelta:t}){return{success:!0,value:{partial:e,textDelta:t}}},validateFinalResult(e){return e===void 0?{success:!1,error:new dn}:{success:!0,value:e}},createElementStream(){throw new xt({functionality:"element streams in no-schema mode"})}},xi=e=>({type:"object",jsonSchema:e.jsonSchema,validatePartialResult({value:t,textDelta:n}){return{success:!0,value:{partial:t,textDelta:n}}},validateFinalResult(t){return Ue({value:t,schema:e})},createElementStream(){throw new xt({functionality:"element streams in object mode"})}}),Ii=e=>{const{$schema:t,...n}=e.jsonSchema;return{type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{elements:{type:"array",items:n}},required:["elements"],additionalProperties:!1},validatePartialResult({value:r,latestObject:a,isFirstDelta:s,isFinalDelta:o}){var i;if(!en(r)||!Mn(r.elements))return{success:!1,error:new Fe({value:r,cause:"value must be an object that contains an array of elements"})};const u=r.elements,l=[];for(let f=0;f<u.length;f++){const y=u[f],p=Ue({value:y,schema:e});if(!(f===u.length-1&&!o)){if(!p.success)return p;l.push(p.value)}}const c=(i=a==null?void 0:a.length)!=null?i:0;let d="";return s&&(d+="["),c>0&&(d+=","),d+=l.slice(c).map(f=>JSON.stringify(f)).join(","),o&&(d+="]"),{success:!0,value:{partial:l,textDelta:d}}},validateFinalResult(r){if(!en(r)||!Mn(r.elements))return{success:!1,error:new Fe({value:r,cause:"value must be an object that contains an array of elements"})};const a=r.elements;for(const s of a){const o=Ue({value:s,schema:e});if(!o.success)return o}return{success:!0,value:a}},createElementStream(r){let a=0;return qe(r,{transform(s,o){switch(s.type){case"object":{const i=s.object;for(;a<i.length;a++)o.enqueue(i[a]);break}case"text-delta":case"finish":break;case"error":o.error(s.error);break;default:{const i=s;throw new Error(`Unsupported chunk type: ${i}`)}}}})}}},Ei=e=>({type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{result:{type:"string",enum:e}},required:["result"],additionalProperties:!1},validateFinalResult(t){if(!en(t)||typeof t.result!="string")return{success:!1,error:new Fe({value:t,cause:'value must be an object that contains a string in the "result" property.'})};const n=t.result;return e.includes(n)?{success:!0,value:n}:{success:!1,error:new Fe({value:t,cause:"value must be a string in the enum"})}},validatePartialResult(){throw new xt({functionality:"partial results in enum mode"})},createElementStream(){throw new xt({functionality:"element streams in enum mode"})}});function sa({output:e,schema:t,enumValues:n}){switch(e){case"object":return xi(Tt(t));case"array":return Ii(Tt(t));case"enum":return Ei(n);case"no-schema":return Ti;default:{const r=e;throw new Error(`Unsupported output: ${r}`)}}}function oa({output:e,mode:t,schema:n,schemaName:r,schemaDescription:a,enumValues:s}){if(e!=null&&e!=="object"&&e!=="array"&&e!=="enum"&&e!=="no-schema")throw new F({parameter:"output",value:e,message:"Invalid output type."});if(e==="no-schema"){if(t==="auto"||t==="tool")throw new F({parameter:"mode",value:t,message:'Mode must be "json" for no-schema output.'});if(n!=null)throw new F({parameter:"schema",value:n,message:"Schema is not supported for no-schema output."});if(a!=null)throw new F({parameter:"schemaDescription",value:a,message:"Schema description is not supported for no-schema output."});if(r!=null)throw new F({parameter:"schemaName",value:r,message:"Schema name is not supported for no-schema output."});if(s!=null)throw new F({parameter:"enumValues",value:s,message:"Enum values are not supported for no-schema output."})}if(e==="object"){if(n==null)throw new F({parameter:"schema",value:n,message:"Schema is required for object output."});if(s!=null)throw new F({parameter:"enumValues",value:s,message:"Enum values are not supported for object output."})}if(e==="array"){if(n==null)throw new F({parameter:"schema",value:n,message:"Element schema is required for array output."});if(s!=null)throw new F({parameter:"enumValues",value:s,message:"Enum values are not supported for array output."})}if(e==="enum"){if(n!=null)throw new F({parameter:"schema",value:n,message:"Schema is not supported for enum output."});if(a!=null)throw new F({parameter:"schemaDescription",value:a,message:"Schema description is not supported for enum output."});if(r!=null)throw new F({parameter:"schemaName",value:r,message:"Schema name is not supported for enum output."});if(s==null)throw new F({parameter:"enumValues",value:s,message:"Enum values are required for enum output."});for(const o of s)if(typeof o!="string")throw new F({parameter:"enumValues",value:o,message:"Enum values must be strings."})}}var Ai=ht({prefix:"aiobj",size:24});async function ki({model:e,enum:t,schema:n,schemaName:r,schemaDescription:a,mode:s,output:o="object",system:i,prompt:u,messages:l,maxRetries:c,abortSignal:d,headers:f,experimental_telemetry:y,experimental_providerMetadata:p,_internal:{generateId:v=Ai,currentDate:T=()=>new Date}={},...h}){oa({output:o,mode:s,schema:n,schemaName:r,schemaDescription:a,enumValues:t});const m=sa({output:o,schema:n,enumValues:t});m.type==="no-schema"&&s===void 0&&(s="json");const w=Ve({model:e,telemetry:y,headers:f,settings:{...h,maxRetries:c}}),S=Ge(y);return oe({name:"ai.generateObject",attributes:N({telemetry:y,attributes:{...se({operationId:"ai.generateObject",telemetry:y}),...w,"ai.prompt":{input:()=>JSON.stringify({system:i,prompt:u,messages:l})},"ai.schema":m.jsonSchema!=null?{input:()=>JSON.stringify(m.jsonSchema)}:void 0,"ai.schema.name":r,"ai.schema.description":a,"ai.settings.output":m.type,"ai.settings.mode":s}}),tracer:S,fn:async R=>{var A,b;const k=Ze({maxRetries:c});(s==="auto"||s==null)&&(s=e.defaultObjectGenerationMode);let G,z,$,X,K,ie,ue,U,C;switch(s){case"json":{const B=Be({prompt:{system:m.jsonSchema==null?Rt({prompt:i}):e.supportsStructuredOutputs?i:Rt({prompt:i,schema:m.jsonSchema}),prompt:u,messages:l},tools:void 0}),Q=await Je({prompt:B,modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:e.supportsUrl}),E=await k(()=>oe({name:"ai.generateObject.doGenerate",attributes:N({telemetry:y,attributes:{...se({operationId:"ai.generateObject.doGenerate",telemetry:y}),...w,"ai.prompt.format":{input:()=>B.type},"ai.prompt.messages":{input:()=>JSON.stringify(Q)},"ai.settings.mode":s,"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":h.frequencyPenalty,"gen_ai.request.max_tokens":h.maxTokens,"gen_ai.request.presence_penalty":h.presencePenalty,"gen_ai.request.temperature":h.temperature,"gen_ai.request.top_k":h.topK,"gen_ai.request.top_p":h.topP}}),tracer:S,fn:async J=>{var ne,ce,Y,ee,fe,te;const M=await e.doGenerate({mode:{type:"object-json",schema:m.jsonSchema,name:r,description:a},...Le(h),inputFormat:B.type,prompt:Q,providerMetadata:p,abortSignal:d,headers:f});if(M.text===void 0)throw new dn;const H={id:(ce=(ne=M.response)==null?void 0:ne.id)!=null?ce:v(),timestamp:(ee=(Y=M.response)==null?void 0:Y.timestamp)!=null?ee:T(),modelId:(te=(fe=M.response)==null?void 0:fe.modelId)!=null?te:e.modelId};return J.setAttributes(N({telemetry:y,attributes:{"ai.response.finishReason":M.finishReason,"ai.response.object":{output:()=>M.text},"ai.response.id":H.id,"ai.response.model":H.modelId,"ai.response.timestamp":H.timestamp.toISOString(),"ai.usage.promptTokens":M.usage.promptTokens,"ai.usage.completionTokens":M.usage.completionTokens,"ai.finishReason":M.finishReason,"ai.result.object":{output:()=>M.text},"gen_ai.response.finish_reasons":[M.finishReason],"gen_ai.response.id":H.id,"gen_ai.response.model":H.modelId,"gen_ai.usage.prompt_tokens":M.usage.promptTokens,"gen_ai.usage.completion_tokens":M.usage.completionTokens}})),{...M,objectText:M.text,responseData:H}}}));G=E.objectText,z=E.finishReason,$=E.usage,X=E.warnings,K=E.rawResponse,U=E.logprobs,C=E.providerMetadata,ue=(A=E.request)!=null?A:{},ie=E.responseData;break}case"tool":{const B=Be({prompt:{system:i,prompt:u,messages:l},tools:void 0}),Q=await Je({prompt:B,modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:e.supportsUrl}),E=B.type,J=await k(()=>oe({name:"ai.generateObject.doGenerate",attributes:N({telemetry:y,attributes:{...se({operationId:"ai.generateObject.doGenerate",telemetry:y}),...w,"ai.prompt.format":{input:()=>E},"ai.prompt.messages":{input:()=>JSON.stringify(Q)},"ai.settings.mode":s,"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":h.frequencyPenalty,"gen_ai.request.max_tokens":h.maxTokens,"gen_ai.request.presence_penalty":h.presencePenalty,"gen_ai.request.temperature":h.temperature,"gen_ai.request.top_k":h.topK,"gen_ai.request.top_p":h.topP}}),tracer:S,fn:async ne=>{var ce,Y,ee,fe,te,M,H,Ie;const P=await e.doGenerate({mode:{type:"object-tool",tool:{type:"function",name:r??"json",description:a??"Respond with a JSON object.",parameters:m.jsonSchema}},...Le(h),inputFormat:E,prompt:Q,providerMetadata:p,abortSignal:d,headers:f}),ve=(Y=(ce=P.toolCalls)==null?void 0:ce[0])==null?void 0:Y.args;if(ve===void 0)throw new dn;const V={id:(fe=(ee=P.response)==null?void 0:ee.id)!=null?fe:v(),timestamp:(M=(te=P.response)==null?void 0:te.timestamp)!=null?M:T(),modelId:(Ie=(H=P.response)==null?void 0:H.modelId)!=null?Ie:e.modelId};return ne.setAttributes(N({telemetry:y,attributes:{"ai.response.finishReason":P.finishReason,"ai.response.object":{output:()=>ve},"ai.response.id":V.id,"ai.response.model":V.modelId,"ai.response.timestamp":V.timestamp.toISOString(),"ai.usage.promptTokens":P.usage.promptTokens,"ai.usage.completionTokens":P.usage.completionTokens,"ai.finishReason":P.finishReason,"ai.result.object":{output:()=>ve},"gen_ai.response.finish_reasons":[P.finishReason],"gen_ai.response.id":V.id,"gen_ai.response.model":V.modelId,"gen_ai.usage.input_tokens":P.usage.promptTokens,"gen_ai.usage.output_tokens":P.usage.completionTokens}})),{...P,objectText:ve,responseData:V}}}));G=J.objectText,z=J.finishReason,$=J.usage,X=J.warnings,K=J.rawResponse,U=J.logprobs,C=J.providerMetadata,ue=(b=J.request)!=null?b:{},ie=J.responseData;break}case void 0:throw new Error("Model does not have a default object generation mode.");default:{const B=s;throw new Error(`Unsupported mode: ${B}`)}}const _=Mr({text:G});if(!_.success)throw _.error;const Z=m.validateFinalResult(_.value);if(!Z.success)throw Z.error;return R.setAttributes(N({telemetry:y,attributes:{"ai.response.finishReason":z,"ai.response.object":{output:()=>JSON.stringify(Z.value)},"ai.usage.promptTokens":$.promptTokens,"ai.usage.completionTokens":$.completionTokens,"ai.finishReason":z,"ai.result.object":{output:()=>JSON.stringify(Z.value)}}})),new Ri({object:Z.value,finishReason:z,usage:Ct($),warnings:X,request:ue,response:{...ie,headers:K==null?void 0:K.headers},logprobs:U,providerMetadata:C})}})}var Ri=class{constructor(e){this.object=e.object,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.experimental_providerMetadata=e.providerMetadata,this.response=e.response,this.request=e.request,this.rawResponse={headers:e.response.headers},this.logprobs=e.logprobs}toJsonResponse(e){var t;return new Response(JSON.stringify(this.object),{status:(t=e==null?void 0:e.status)!=null?t:200,headers:Ne(e,{contentType:"application/json; charset=utf-8"})})}},ql=ki;function he(){let e,t;return{promise:new Promise((r,a)=>{e=r,t=a}),resolve:e,reject:t}}var Ni=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get value(){return this.promise?this.promise:(this.promise=new Promise((e,t)=>{this.status.type==="resolved"?e(this.status.value):this.status.type==="rejected"&&t(this.status.error),this._resolve=e,this._reject=t}),this.promise)}resolve(e){var t;this.status={type:"resolved",value:e},this.promise&&((t=this._resolve)==null||t.call(this,e))}reject(e){var t;this.status={type:"rejected",error:e},this.promise&&((t=this._reject)==null||t.call(this,e))}};function ia(){var e,t;return(t=(e=globalThis==null?void 0:globalThis.performance)==null?void 0:e.now())!=null?t:Date.now()}function pn(e,{contentType:t,dataStreamVersion:n}){const r={};if((e==null?void 0:e.headers)!=null)for(const[a,s]of Object.entries(e.headers))r[a]=s;return r["Content-Type"]==null&&(r["Content-Type"]=t),n!==void 0&&(r["X-Vercel-AI-Data-Stream"]=n),r}function fn({response:e,status:t,statusText:n,headers:r,stream:a}){e.writeHead(t??200,n,r);const s=a.getReader();(async()=>{try{for(;;){const{done:i,value:u}=await s.read();if(i)break;e.write(u)}}catch(i){throw i}finally{e.end()}})()}var Ci=ht({prefix:"aiobj",size:24});async function Oi({model:e,schema:t,schemaName:n,schemaDescription:r,mode:a,output:s="object",system:o,prompt:i,messages:u,maxRetries:l,abortSignal:c,headers:d,experimental_telemetry:f,experimental_providerMetadata:y,onFinish:p,_internal:{generateId:v=Ci,currentDate:T=()=>new Date,now:h=ia}={},...m}){oa({output:s,mode:a,schema:t,schemaName:n,schemaDescription:r});const w=sa({output:s,schema:t});w.type==="no-schema"&&a===void 0&&(a="json");const S=Ve({model:e,telemetry:f,headers:d,settings:{...m,maxRetries:l}}),R=Ge(f),A=Ze({maxRetries:l});return oe({name:"ai.streamObject",attributes:N({telemetry:f,attributes:{...se({operationId:"ai.streamObject",telemetry:f}),...S,"ai.prompt":{input:()=>JSON.stringify({system:o,prompt:i,messages:u})},"ai.schema":w.jsonSchema!=null?{input:()=>JSON.stringify(w.jsonSchema)}:void 0,"ai.schema.name":n,"ai.schema.description":r,"ai.settings.output":w.type,"ai.settings.mode":a}}),tracer:R,endWhenDone:!1,fn:async b=>{(a==="auto"||a==null)&&(a=e.defaultObjectGenerationMode);let k,G;switch(a){case"json":{const U=Be({prompt:{system:w.jsonSchema==null?Rt({prompt:o}):e.supportsStructuredOutputs?o:Rt({prompt:o,schema:w.jsonSchema}),prompt:i,messages:u},tools:void 0});k={mode:{type:"object-json",schema:w.jsonSchema,name:n,description:r},...Le(m),inputFormat:U.type,prompt:await Je({prompt:U,modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:e.supportsUrl}),providerMetadata:y,abortSignal:c,headers:d},G={transform:(C,_)=>{switch(C.type){case"text-delta":_.enqueue(C.textDelta);break;case"response-metadata":case"finish":case"error":_.enqueue(C);break}}};break}case"tool":{const U=Be({prompt:{system:o,prompt:i,messages:u},tools:void 0});k={mode:{type:"object-tool",tool:{type:"function",name:n??"json",description:r??"Respond with a JSON object.",parameters:w.jsonSchema}},...Le(m),inputFormat:U.type,prompt:await Je({prompt:U,modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:e.supportsUrl}),providerMetadata:y,abortSignal:c,headers:d},G={transform(C,_){switch(C.type){case"tool-call-delta":_.enqueue(C.argsTextDelta);break;case"response-metadata":case"finish":case"error":_.enqueue(C);break}}};break}case void 0:throw new Error("Model does not have a default object generation mode.");default:{const U=a;throw new Error(`Unsupported mode: ${U}`)}}const{result:{stream:z,warnings:$,rawResponse:X,request:K},doStreamSpan:ie,startTimestampMs:ue}=await A(()=>oe({name:"ai.streamObject.doStream",attributes:N({telemetry:f,attributes:{...se({operationId:"ai.streamObject.doStream",telemetry:f}),...S,"ai.prompt.format":{input:()=>k.inputFormat},"ai.prompt.messages":{input:()=>JSON.stringify(k.prompt)},"ai.settings.mode":a,"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":m.frequencyPenalty,"gen_ai.request.max_tokens":m.maxTokens,"gen_ai.request.presence_penalty":m.presencePenalty,"gen_ai.request.temperature":m.temperature,"gen_ai.request.top_k":m.topK,"gen_ai.request.top_p":m.topP}}),tracer:R,endWhenDone:!1,fn:async U=>({startTimestampMs:h(),doStreamSpan:U,result:await e.doStream(k)})}));return new Mi({outputStrategy:w,stream:z.pipeThrough(new TransformStream(G)),warnings:$,rawResponse:X,request:K??{},onFinish:p,rootSpan:b,doStreamSpan:ie,telemetry:f,startTimestampMs:ue,modelId:e.modelId,now:h,currentDate:T,generateId:v})}})}var Mi=class{constructor({stream:e,warnings:t,rawResponse:n,request:r,outputStrategy:a,onFinish:s,rootSpan:o,doStreamSpan:i,telemetry:u,startTimestampMs:l,modelId:c,now:d,currentDate:f,generateId:y}){this.warnings=t,this.rawResponse=n,this.outputStrategy=a,this.request=Promise.resolve(r),this.objectPromise=new Ni;const{resolve:p,promise:v}=he();this.usage=v;const{resolve:T,promise:h}=he();this.response=h;const{resolve:m,promise:w}=he();this.experimental_providerMetadata=w;let S,R,A,b,k,G="",z="",$={id:y(),timestamp:f(),modelId:c},X,K,ie=!0,ue=!0;const U=this;this.originalStream=e.pipeThrough(new TransformStream({async transform(C,_){var Z,B,Q;if(ie){const E=d()-l;ie=!1,i.addEvent("ai.stream.firstChunk",{"ai.stream.msToFirstChunk":E}),i.setAttributes({"ai.stream.msToFirstChunk":E})}if(typeof C=="string"){G+=C,z+=C;const{value:E,state:J}=ar(G);if(E!==void 0&&!St(X,E)){const ne=a.validatePartialResult({value:E,textDelta:z,latestObject:K,isFirstDelta:ue,isFinalDelta:J==="successful-parse"});ne.success&&!St(K,ne.value.partial)&&(X=E,K=ne.value.partial,_.enqueue({type:"object",object:K}),_.enqueue({type:"text-delta",textDelta:ne.value.textDelta}),z="",ue=!1)}return}switch(C.type){case"response-metadata":{$={id:(Z=C.id)!=null?Z:$.id,timestamp:(B=C.timestamp)!=null?B:$.timestamp,modelId:(Q=C.modelId)!=null?Q:$.modelId};break}case"finish":{z!==""&&_.enqueue({type:"text-delta",textDelta:z}),R=C.finishReason,S=Ct(C.usage),A=C.providerMetadata,_.enqueue({...C,usage:S,response:$}),p(S),m(A),T({...$,headers:n==null?void 0:n.headers});const E=a.validateFinalResult(X);E.success?(b=E.value,U.objectPromise.resolve(b)):(k=E.error,U.objectPromise.reject(k));break}default:{_.enqueue(C);break}}},async flush(C){try{const _=S??{promptTokens:NaN,completionTokens:NaN,totalTokens:NaN};i.setAttributes(N({telemetry:u,attributes:{"ai.response.finishReason":R,"ai.response.object":{output:()=>JSON.stringify(b)},"ai.response.id":$.id,"ai.response.model":$.modelId,"ai.response.timestamp":$.timestamp.toISOString(),"ai.usage.promptTokens":_.promptTokens,"ai.usage.completionTokens":_.completionTokens,"ai.finishReason":R,"ai.result.object":{output:()=>JSON.stringify(b)},"gen_ai.response.finish_reasons":[R],"gen_ai.response.id":$.id,"gen_ai.response.model":$.modelId,"gen_ai.usage.input_tokens":_.promptTokens,"gen_ai.usage.output_tokens":_.completionTokens}})),i.end(),o.setAttributes(N({telemetry:u,attributes:{"ai.usage.promptTokens":_.promptTokens,"ai.usage.completionTokens":_.completionTokens,"ai.response.object":{output:()=>JSON.stringify(b)},"ai.result.object":{output:()=>JSON.stringify(b)}}})),await(s==null?void 0:s({usage:_,object:b,error:k,rawResponse:n,response:{...$,headers:n==null?void 0:n.headers},warnings:t,experimental_providerMetadata:A}))}catch(_){C.error(_)}finally{o.end()}}}))}get object(){return this.objectPromise.value}get partialObjectStream(){return qe(this.originalStream,{transform(e,t){switch(e.type){case"object":t.enqueue(e.object);break;case"text-delta":case"finish":break;case"error":t.error(e.error);break;default:{const n=e;throw new Error(`Unsupported chunk type: ${n}`)}}}})}get elementStream(){return this.outputStrategy.createElementStream(this.originalStream)}get textStream(){return qe(this.originalStream,{transform(e,t){switch(e.type){case"text-delta":t.enqueue(e.textDelta);break;case"object":case"finish":break;case"error":t.error(e.error);break;default:{const n=e;throw new Error(`Unsupported chunk type: ${n}`)}}}})}get fullStream(){return qe(this.originalStream,{transform(e,t){t.enqueue(e)}})}pipeTextStreamToResponse(e,t){fn({response:e,status:t==null?void 0:t.status,statusText:t==null?void 0:t.statusText,headers:pn(t,{contentType:"text/plain; charset=utf-8"}),stream:this.textStream.pipeThrough(new TextEncoderStream)})}toTextStreamResponse(e){var t;return new Response(this.textStream.pipeThrough(new TextEncoderStream),{status:(t=e==null?void 0:e.status)!=null?t:200,headers:Ne(e,{contentType:"text/plain; charset=utf-8"})})}},Fl=Oi,mn="AI_InvalidToolArgumentsError",la=`vercel.ai.error.${mn}`,Pi=Symbol.for(la),ua,ji=class extends I{constructor({toolArgs:e,toolName:t,cause:n,message:r=`Invalid arguments for tool ${t}: ${yn(n)}`}){super({name:mn,message:r,cause:n}),this[ua]=!0,this.toolArgs=e,this.toolName=t}static isInstance(e){return I.hasMarker(e,la)}static isInvalidToolArgumentsError(e){return e instanceof Error&&e.name===mn&&typeof e.toolName=="string"&&typeof e.toolArgs=="string"}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,toolName:this.toolName,toolArgs:this.toolArgs}}};ua=Pi;var gn="AI_NoSuchToolError",ca=`vercel.ai.error.${gn}`,Di=Symbol.for(ca),da,Nt=class extends I{constructor({toolName:e,availableTools:t=void 0,message:n=`Model tried to call unavailable tool '${e}'. ${t===void 0?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:gn,message:n}),this[da]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return I.hasMarker(e,ca)}static isNoSuchToolError(e){return e instanceof Error&&e.name===gn&&"toolName"in e&&e.toolName!=null&&typeof e.name=="string"}toJSON(){return{name:this.name,message:this.message,stack:this.stack,toolName:this.toolName,availableTools:this.availableTools}}};da=Di;function $i(e){return e!=null&&Object.keys(e).length>0}function pa({tools:e,toolChoice:t,activeTools:n}){return $i(e)?{tools:(n!=null?Object.entries(e).filter(([a])=>n.includes(a)):Object.entries(e)).map(([a,s])=>{const o=s.type;switch(o){case void 0:case"function":return{type:"function",name:a,description:s.description,parameters:Tt(s.parameters).jsonSchema};case"provider-defined":return{type:"provider-defined",name:a,id:s.id,args:s.args};default:{const i=o;throw new Error(`Unsupported tool type: ${i}`)}}}),toolChoice:t==null?{type:"auto"}:typeof t=="string"?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}var qi=/^([\s\S]*?)(\s+)(\S*)$/;function fa(e){const t=e.match(qi);return t?{prefix:t[1],whitespace:t[2],suffix:t[3]}:void 0}function Fi(e){const t=fa(e);return t?t.prefix+t.whitespace:e}function ma({toolCall:e,tools:t}){const n=e.toolName;if(t==null)throw new Nt({toolName:e.toolName});const r=t[n];if(r==null)throw new Nt({toolName:e.toolName,availableTools:Object.keys(t)});const a=Tt(r.parameters),s=e.args.trim()===""?Ue({value:{},schema:a}):Mr({text:e.args,schema:a});if(s.success===!1)throw new ji({toolName:n,toolArgs:e.args,cause:s.error});return{type:"tool-call",toolCallId:e.toolCallId,toolName:n,args:s.value}}function ga({text:e="",tools:t,toolCalls:n,toolResults:r}){const a=[];return a.push({role:"assistant",content:[{type:"text",text:e},...n]}),r.length>0&&a.push({role:"tool",content:r.map(s=>{const o=t[s.toolName];return(o==null?void 0:o.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:s.toolCallId,toolName:s.toolName,result:o.experimental_toToolResultContent(s.result),experimental_content:o.experimental_toToolResultContent(s.result)}:{type:"tool-result",toolCallId:s.toolCallId,toolName:s.toolName,result:s.result}})}),a}var Ui=ht({prefix:"aitxt",size:24});async function Ji({model:e,tools:t,toolChoice:n,system:r,prompt:a,messages:s,maxRetries:o,abortSignal:i,headers:u,maxAutomaticRoundtrips:l=0,maxToolRoundtrips:c=l,maxSteps:d=c!=null?c+1:1,experimental_continuationSteps:f,experimental_continueSteps:y=f??!1,experimental_telemetry:p,experimental_providerMetadata:v,experimental_activeTools:T,_internal:{generateId:h=Ui,currentDate:m=()=>new Date}={},onStepFinish:w,...S}){if(d<1)throw new F({parameter:"maxSteps",value:d,message:"maxSteps must be at least 1"});const R=Ve({model:e,telemetry:p,headers:u,settings:{...S,maxRetries:o}}),A=Be({prompt:{system:r,prompt:a,messages:s},tools:t}),b=Ge(p);return oe({name:"ai.generateText",attributes:N({telemetry:p,attributes:{...se({operationId:"ai.generateText",telemetry:p}),...R,"ai.prompt":{input:()=>JSON.stringify({system:r,prompt:a,messages:s})},"ai.settings.maxSteps":d}}),tracer:b,fn:async k=>{var G,z,$,X,K,ie;const ue=Ze({maxRetries:o}),U={type:"regular",...pa({tools:t,toolChoice:n,activeTools:T})},C=Le(S);let _,Z=[],B=[],Q=0;const E=[];let J="";const ne=[],ce={completionTokens:0,promptTokens:0,totalTokens:0};let Y="initial";do{Q===1&&(A.type="messages");const ee=Q===0?A.type:"messages",fe=await Je({prompt:{type:ee,system:A.system,messages:[...A.messages,...E]},modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:e.supportsUrl});_=await ue(()=>oe({name:"ai.generateText.doGenerate",attributes:N({telemetry:p,attributes:{...se({operationId:"ai.generateText.doGenerate",telemetry:p}),...R,"ai.prompt.format":{input:()=>ee},"ai.prompt.messages":{input:()=>JSON.stringify(fe)},"ai.prompt.tools":{input:()=>{var V;return(V=U.tools)==null?void 0:V.map(Ce=>JSON.stringify(Ce))}},"ai.prompt.toolChoice":{input:()=>U.toolChoice!=null?JSON.stringify(U.toolChoice):void 0},"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":S.frequencyPenalty,"gen_ai.request.max_tokens":S.maxTokens,"gen_ai.request.presence_penalty":S.presencePenalty,"gen_ai.request.stop_sequences":S.stopSequences,"gen_ai.request.temperature":S.temperature,"gen_ai.request.top_k":S.topK,"gen_ai.request.top_p":S.topP}}),tracer:b,fn:async V=>{var Ce,Oe,_t,me,Te,re;const q=await e.doGenerate({mode:U,...C,inputFormat:ee,prompt:fe,providerMetadata:v,abortSignal:i,headers:u}),ge={id:(Oe=(Ce=q.response)==null?void 0:Ce.id)!=null?Oe:h(),timestamp:(me=(_t=q.response)==null?void 0:_t.timestamp)!=null?me:m(),modelId:(re=(Te=q.response)==null?void 0:Te.modelId)!=null?re:e.modelId};return V.setAttributes(N({telemetry:p,attributes:{"ai.response.finishReason":q.finishReason,"ai.response.text":{output:()=>q.text},"ai.response.toolCalls":{output:()=>JSON.stringify(q.toolCalls)},"ai.response.id":ge.id,"ai.response.model":ge.modelId,"ai.response.timestamp":ge.timestamp.toISOString(),"ai.usage.promptTokens":q.usage.promptTokens,"ai.usage.completionTokens":q.usage.completionTokens,"ai.finishReason":q.finishReason,"ai.result.text":{output:()=>q.text},"ai.result.toolCalls":{output:()=>JSON.stringify(q.toolCalls)},"gen_ai.response.finish_reasons":[q.finishReason],"gen_ai.response.id":ge.id,"gen_ai.response.model":ge.modelId,"gen_ai.usage.input_tokens":q.usage.promptTokens,"gen_ai.usage.output_tokens":q.usage.completionTokens}})),{...q,response:ge}}})),Z=((G=_.toolCalls)!=null?G:[]).map(V=>ma({toolCall:V,tools:t})),B=t==null?[]:await Li({toolCalls:Z,tools:t,tracer:b,telemetry:p,abortSignal:i});const te=Ct(_.usage);ce.completionTokens+=te.completionTokens,ce.promptTokens+=te.promptTokens,ce.totalTokens+=te.totalTokens;let M="done";++Q<d&&(y&&_.finishReason==="length"&&Z.length===0?M="continue":Z.length>0&&B.length===Z.length&&(M="tool-result"));const H=(z=_.text)!=null?z:"",Ie=Y==="continue"&&J.trimEnd()!==J?H.trimStart():H,P=M==="continue"?Fi(Ie):Ie;if(J=M==="continue"||Y==="continue"?J+P:P,Y==="continue"){const V=E[E.length-1];typeof V.content=="string"?V.content+=P:V.content.push({text:P,type:"text"})}else E.push(...ga({text:J,tools:t??{},toolCalls:Z,toolResults:B}));const ve={stepType:Y,text:P,toolCalls:Z,toolResults:B,finishReason:_.finishReason,usage:te,warnings:_.warnings,logprobs:_.logprobs,request:($=_.request)!=null?$:{},response:{..._.response,headers:(X=_.rawResponse)==null?void 0:X.headers,messages:JSON.parse(JSON.stringify(E))},experimental_providerMetadata:_.providerMetadata,isContinued:M==="continue"};ne.push(ve),await(w==null?void 0:w(ve)),Y=M}while(Y!=="done");return k.setAttributes(N({telemetry:p,attributes:{"ai.response.finishReason":_.finishReason,"ai.response.text":{output:()=>_.text},"ai.response.toolCalls":{output:()=>JSON.stringify(_.toolCalls)},"ai.usage.promptTokens":_.usage.promptTokens,"ai.usage.completionTokens":_.usage.completionTokens,"ai.finishReason":_.finishReason,"ai.result.text":{output:()=>_.text},"ai.result.toolCalls":{output:()=>JSON.stringify(_.toolCalls)}}})),new Bi({text:J,toolCalls:Z,toolResults:B,finishReason:_.finishReason,usage:ce,warnings:_.warnings,request:(K=_.request)!=null?K:{},response:{..._.response,headers:(ie=_.rawResponse)==null?void 0:ie.headers,messages:E},logprobs:_.logprobs,responseMessages:E,steps:ne,providerMetadata:_.providerMetadata})}})}async function Li({toolCalls:e,tools:t,tracer:n,telemetry:r,abortSignal:a}){return(await Promise.all(e.map(async o=>{const i=t[o.toolName];if((i==null?void 0:i.execute)==null)return;const u=await oe({name:"ai.toolCall",attributes:N({telemetry:r,attributes:{...se({operationId:"ai.toolCall",telemetry:r}),"ai.toolCall.name":o.toolName,"ai.toolCall.id":o.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(o.args)}}}),tracer:n,fn:async l=>{const c=await i.execute(o.args,{abortSignal:a});try{l.setAttributes(N({telemetry:r,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(c)}}}))}catch{}return c}});return{toolCallId:o.toolCallId,toolName:o.toolName,args:o.args,result:u}}))).filter(o=>o!=null)}var Bi=class{constructor(e){this.text=e.text,this.toolCalls=e.toolCalls,this.toolResults=e.toolResults,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.request=e.request,this.response=e.response,this.responseMessages=e.responseMessages,this.roundtrips=e.steps,this.steps=e.steps,this.experimental_providerMetadata=e.providerMetadata,this.rawResponse={headers:e.response.headers},this.logprobs=e.logprobs}},Ul=Ji;function Zi(){let e=[],t=null,n=!1;const r=async()=>{if(n&&e.length===0){t==null||t.close();return}if(e.length!==0)try{const{value:a,done:s}=await e[0].read();s?(e.shift(),e.length>0?await r():n&&(t==null||t.close())):t==null||t.enqueue(a)}catch(a){t==null||t.error(a),e.shift(),n&&e.length===0&&(t==null||t.close())}};return{stream:new ReadableStream({start(a){t=a},pull:r,async cancel(){for(const a of e)await a.cancel();e=[],n=!0}}),addStream:a=>{if(n)throw new Error("Cannot add inner stream: outer stream is closed");e.push(a.getReader())},close:()=>{n=!0,e.length===0&&(t==null||t.close())}}}function yt(e,t){const n=e.getReader(),r=t.getReader();let a,s,o=!1,i=!1;async function u(c){try{a==null&&(a=n.read());const d=await a;a=void 0,d.done?c.close():c.enqueue(d.value)}catch(d){c.error(d)}}async function l(c){try{s==null&&(s=r.read());const d=await s;s=void 0,d.done?c.close():c.enqueue(d.value)}catch(d){c.error(d)}}return new ReadableStream({async pull(c){try{if(o){await l(c);return}if(i){await u(c);return}a==null&&(a=n.read()),s==null&&(s=r.read());const{result:d,reader:f}=await Promise.race([a.then(y=>({result:y,reader:n})),s.then(y=>({result:y,reader:r}))]);d.done||c.enqueue(d.value),f===n?(a=void 0,d.done&&(await l(c),o=!0)):(s=void 0,d.done&&(i=!0,await u(c)))}catch(d){c.error(d)}},cancel(){n.cancel(),r.cancel()}})}function Vi({tools:e,generatorStream:t,toolCallStreaming:n,tracer:r,telemetry:a,abortSignal:s}){let o=null;const i=new ReadableStream({start(p){o=p}}),u={},l=new Set;let c=!1,d;function f(){c&&l.size===0&&(d!=null&&o.enqueue(d),o.close())}const y=new TransformStream({transform(p,v){const T=p.type;switch(T){case"text-delta":case"response-metadata":case"error":{v.enqueue(p);break}case"tool-call-delta":{n&&(u[p.toolCallId]||(v.enqueue({type:"tool-call-streaming-start",toolCallId:p.toolCallId,toolName:p.toolName}),u[p.toolCallId]=!0),v.enqueue({type:"tool-call-delta",toolCallId:p.toolCallId,toolName:p.toolName,argsTextDelta:p.argsTextDelta}));break}case"tool-call":{const h=p.toolName;if(e==null){o.enqueue({type:"error",error:new Nt({toolName:p.toolName})});break}const m=e[h];if(m==null){o.enqueue({type:"error",error:new Nt({toolName:p.toolName,availableTools:Object.keys(e)})});break}try{const w=ma({toolCall:p,tools:e});if(v.enqueue(w),m.execute!=null){const S=Xn();l.add(S),oe({name:"ai.toolCall",attributes:N({telemetry:a,attributes:{...se({operationId:"ai.toolCall",telemetry:a}),"ai.toolCall.name":w.toolName,"ai.toolCall.id":w.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(w.args)}}}),tracer:r,fn:async R=>m.execute(w.args,{abortSignal:s}).then(A=>{o.enqueue({...w,type:"tool-result",result:A}),l.delete(S),f();try{R.setAttributes(N({telemetry:a,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(A)}}}))}catch{}},A=>{o.enqueue({type:"error",error:A}),l.delete(S),f()})})}}catch(w){o.enqueue({type:"error",error:w})}break}case"finish":{d={type:"finish",finishReason:p.finishReason,logprobs:p.logprobs,usage:Ct(p.usage),experimental_providerMetadata:p.providerMetadata};break}default:{const h=T;throw new Error(`Unhandled chunk type: ${h}`)}}},flush(){c=!0,f()}});return new ReadableStream({async start(p){return Promise.all([t.pipeThrough(y).pipeTo(new WritableStream({write(v){p.enqueue(v)},close(){}})),i.pipeTo(new WritableStream({write(v){p.enqueue(v)},close(){p.close()}}))])}})}var Gi=ht({prefix:"aitxt",size:24});async function zi({model:e,tools:t,toolChoice:n,system:r,prompt:a,messages:s,maxRetries:o,abortSignal:i,headers:u,maxToolRoundtrips:l=0,maxSteps:c=l!=null?l+1:1,experimental_continueSteps:d=!1,experimental_telemetry:f,experimental_providerMetadata:y,experimental_toolCallStreaming:p=!1,experimental_activeTools:v,onChunk:T,onFinish:h,onStepFinish:m,_internal:{now:w=ia,generateId:S=Gi,currentDate:R=()=>new Date}={},...A}){if(c<1)throw new F({parameter:"maxSteps",value:c,message:"maxSteps must be at least 1"});const b=Ve({model:e,telemetry:f,headers:u,settings:{...A,maxRetries:o}}),k=Ge(f),G=Be({prompt:{system:r,prompt:a,messages:s},tools:t});return oe({name:"ai.streamText",attributes:N({telemetry:f,attributes:{...se({operationId:"ai.streamText",telemetry:f}),...b,"ai.prompt":{input:()=>JSON.stringify({system:r,prompt:a,messages:s})},"ai.settings.maxSteps":c}}),tracer:k,endWhenDone:!1,fn:async z=>{const $=Ze({maxRetries:o}),X=async({responseMessages:Z})=>{const B=Z.length===0?G.type:"messages",Q=await Je({prompt:{type:B,system:G.system,messages:[...G.messages,...Z]},modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:e.supportsUrl}),E={type:"regular",...pa({tools:t,toolChoice:n,activeTools:v})},{result:{stream:J,warnings:ne,rawResponse:ce,request:Y},doStreamSpan:ee,startTimestampMs:fe}=await $(()=>oe({name:"ai.streamText.doStream",attributes:N({telemetry:f,attributes:{...se({operationId:"ai.streamText.doStream",telemetry:f}),...b,"ai.prompt.format":{input:()=>B},"ai.prompt.messages":{input:()=>JSON.stringify(Q)},"ai.prompt.tools":{input:()=>{var te;return(te=E.tools)==null?void 0:te.map(M=>JSON.stringify(M))}},"ai.prompt.toolChoice":{input:()=>E.toolChoice!=null?JSON.stringify(E.toolChoice):void 0},"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":A.frequencyPenalty,"gen_ai.request.max_tokens":A.maxTokens,"gen_ai.request.presence_penalty":A.presencePenalty,"gen_ai.request.stop_sequences":A.stopSequences,"gen_ai.request.temperature":A.temperature,"gen_ai.request.top_k":A.topK,"gen_ai.request.top_p":A.topP}}),tracer:k,endWhenDone:!1,fn:async te=>({startTimestampMs:w(),doStreamSpan:te,result:await e.doStream({mode:E,...Le(A),inputFormat:B,prompt:Q,providerMetadata:y,abortSignal:i,headers:u})})}));return{result:{stream:Vi({tools:t,generatorStream:J,toolCallStreaming:p,tracer:k,telemetry:f,abortSignal:i}),warnings:ne,request:Y??{},rawResponse:ce},doStreamSpan:ee,startTimestampMs:fe}},{result:{stream:K,warnings:ie,rawResponse:ue,request:U},doStreamSpan:C,startTimestampMs:_}=await X({responseMessages:[]});return new Wi({stream:K,warnings:ie,rawResponse:ue,request:U,onChunk:T,onFinish:h,onStepFinish:m,rootSpan:z,doStreamSpan:C,telemetry:f,startTimestampMs:_,maxSteps:c,continueSteps:d,startStep:X,modelId:e.modelId,now:w,currentDate:R,generateId:S,tools:t})}})}var Wi=class{constructor({stream:e,warnings:t,rawResponse:n,request:r,onChunk:a,onFinish:s,onStepFinish:o,rootSpan:i,doStreamSpan:u,telemetry:l,startTimestampMs:c,maxSteps:d,continueSteps:f,startStep:y,modelId:p,now:v,currentDate:T,generateId:h,tools:m}){this.warnings=t,this.rawResponse=n;const{resolve:w,promise:S}=he();this.usage=S;const{resolve:R,promise:A}=he();this.finishReason=A;const{resolve:b,promise:k}=he();this.text=k;const{resolve:G,promise:z}=he();this.toolCalls=z;const{resolve:$,promise:X}=he();this.toolResults=X;const{resolve:K,promise:ie}=he();this.steps=ie;const{resolve:ue,promise:U}=he();this.experimental_providerMetadata=U;const{resolve:C,promise:_}=he();this.request=_;const{resolve:Z,promise:B}=he();this.response=B;const{resolve:Q,promise:E}=he();this.responseMessages=E;const{stream:J,addStream:ne,close:ce}=Zi();this.originalStream=J;const Y=[],ee=this;function fe({stream:te,startTimestamp:M,doStreamSpan:H,currentStep:Ie,responseMessages:P,usage:ve={promptTokens:0,completionTokens:0,totalTokens:0},stepType:V,previousStepText:Ce="",stepRequest:Oe,hasLeadingWhitespace:_t}){const me=[],Te=[];let re="unknown",q={promptTokens:0,completionTokens:0,totalTokens:0},ge,In=!0,Ae="",Me=V==="continue"?Ce:"",We,de={id:h(),timestamp:T(),modelId:p},Pe="",En=!1,An=!0,kn=!1;async function Pt({controller:j,chunk:ae}){j.enqueue(ae),Ae+=ae.textDelta,Me+=ae.textDelta,En=!0,kn=ae.textDelta.trimEnd()!==ae.textDelta,await(a==null?void 0:a({chunk:ae}))}ne(te.pipeThrough(new TransformStream({async transform(j,ae){var ke,Se,Ke;if(In){const L=v()-M;In=!1,H.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":L,"ai.stream.msToFirstChunk":L}),H.setAttributes({"ai.response.msToFirstChunk":L,"ai.stream.msToFirstChunk":L})}if(j.type==="text-delta"&&j.textDelta.length===0)return;const xe=j.type;switch(xe){case"text-delta":{if(f){const L=An&&_t?j.textDelta.trimStart():j.textDelta;if(L.length===0)break;An=!1,Pe+=L;const je=fa(Pe);je!=null&&(Pe=je.suffix,await Pt({controller:ae,chunk:{type:"text-delta",textDelta:je.prefix+je.whitespace}}))}else await Pt({controller:ae,chunk:j});break}case"tool-call":{ae.enqueue(j),me.push(j),await(a==null?void 0:a({chunk:j}));break}case"tool-result":{ae.enqueue(j),Te.push(j),await(a==null?void 0:a({chunk:j}));break}case"response-metadata":{de={id:(ke=j.id)!=null?ke:de.id,timestamp:(Se=j.timestamp)!=null?Se:de.timestamp,modelId:(Ke=j.modelId)!=null?Ke:de.modelId};break}case"finish":{q=j.usage,re=j.finishReason,ge=j.experimental_providerMetadata,We=j.logprobs;const L=v()-M;H.addEvent("ai.stream.finish"),H.setAttributes({"ai.response.msToFinish":L,"ai.response.avgCompletionTokensPerSecond":1e3*q.completionTokens/L});break}case"tool-call-streaming-start":case"tool-call-delta":{ae.enqueue(j),await(a==null?void 0:a({chunk:j}));break}case"error":{ae.enqueue(j),re="error";break}default:{const L=xe;throw new Error(`Unknown chunk type: ${L}`)}}},async flush(j){var ae;const ke=me.length>0?JSON.stringify(me):void 0;let Se="done";Ie+1<d&&(f&&re==="length"&&me.length===0?Se="continue":me.length>0&&Te.length===me.length&&(Se="tool-result")),f&&Pe.length>0&&(Se!=="continue"||V==="continue"&&!En)&&(await Pt({controller:j,chunk:{type:"text-delta",textDelta:Pe}}),Pe="");try{H.setAttributes(N({telemetry:l,attributes:{"ai.response.finishReason":re,"ai.response.text":{output:()=>Ae},"ai.response.toolCalls":{output:()=>ke},"ai.response.id":de.id,"ai.response.model":de.modelId,"ai.response.timestamp":de.timestamp.toISOString(),"ai.usage.promptTokens":q.promptTokens,"ai.usage.completionTokens":q.completionTokens,"ai.finishReason":re,"ai.result.text":{output:()=>Ae},"ai.result.toolCalls":{output:()=>ke},"gen_ai.response.finish_reasons":[re],"gen_ai.response.id":de.id,"gen_ai.response.model":de.modelId,"gen_ai.usage.input_tokens":q.promptTokens,"gen_ai.usage.output_tokens":q.completionTokens}}))}catch{}finally{H.end()}if(j.enqueue({type:"step-finish",finishReason:re,usage:q,experimental_providerMetadata:ge,logprobs:We,response:{...de},isContinued:Se==="continue"}),V==="continue"){const L=P[P.length-1];typeof L.content=="string"?L.content+=Ae:L.content.push({text:Ae,type:"text"})}else P.push(...ga({text:Ae,tools:m??{},toolCalls:me,toolResults:Te}));const Ke={stepType:V,text:Ae,toolCalls:me,toolResults:Te,finishReason:re,usage:q,warnings:ee.warnings,logprobs:We,request:Oe,rawResponse:ee.rawResponse,response:{...de,headers:(ae=ee.rawResponse)==null?void 0:ae.headers,messages:JSON.parse(JSON.stringify(P))},experimental_providerMetadata:ge,isContinued:Se==="continue"};Y.push(Ke),await(o==null?void 0:o(Ke));const xe={promptTokens:ve.promptTokens+q.promptTokens,completionTokens:ve.completionTokens+q.completionTokens,totalTokens:ve.totalTokens+q.totalTokens};if(Se!=="done"){const{result:L,doStreamSpan:je,startTimestampMs:wa}=await y({responseMessages:P});ee.warnings=L.warnings,ee.rawResponse=L.rawResponse,fe({stream:L.stream,startTimestamp:wa,doStreamSpan:je,currentStep:Ie+1,responseMessages:P,usage:xe,stepType:Se,previousStepText:Me,stepRequest:L.request,hasLeadingWhitespace:kn});return}try{j.enqueue({type:"finish",finishReason:re,usage:xe,experimental_providerMetadata:ge,logprobs:We,response:{...de}}),ce(),i.setAttributes(N({telemetry:l,attributes:{"ai.response.finishReason":re,"ai.response.text":{output:()=>Me},"ai.response.toolCalls":{output:()=>ke},"ai.usage.promptTokens":xe.promptTokens,"ai.usage.completionTokens":xe.completionTokens,"ai.finishReason":re,"ai.result.text":{output:()=>Me},"ai.result.toolCalls":{output:()=>ke}}})),w(xe),R(re),b(Me),G(me),ue(ge),$(Te),C(Oe),Z({...de,headers:n==null?void 0:n.headers,messages:P}),K(Y),Q(P),await(s==null?void 0:s({finishReason:re,logprobs:We,usage:xe,text:Me,toolCalls:me,toolResults:Te,request:Oe,rawResponse:n,response:{...de,headers:n==null?void 0:n.headers,messages:P},warnings:t,experimental_providerMetadata:ge,steps:Y,responseMessages:P}))}catch(L){j.error(L)}finally{i.end()}}})))}fe({stream:e,startTimestamp:c,doStreamSpan:u,currentStep:0,responseMessages:[],usage:void 0,stepType:"initial",stepRequest:r,hasLeadingWhitespace:!1})}teeStream(){const[e,t]=this.originalStream.tee();return this.originalStream=t,e}get textStream(){return qe(this.teeStream(),{transform(e,t){e.type==="text-delta"?t.enqueue(e.textDelta):e.type==="error"&&t.error(e.error)}})}get fullStream(){return qe(this.teeStream(),{transform(e,t){t.enqueue(e)}})}toAIStream(e={}){return this.toDataStreamInternal({callbacks:e})}toDataStreamInternal({callbacks:e={},getErrorMessage:t=()=>"",sendUsage:n=!0}={}){let r="";const a=new TransformStream({async start(){e.onStart&&await e.onStart()},async transform(o,i){if(i.enqueue(o),o.type==="text-delta"){const u=o.textDelta;r+=u,e.onToken&&await e.onToken(u),e.onText&&await e.onText(u)}},async flush(){e.onCompletion&&await e.onCompletion(r),e.onFinal&&await e.onFinal(r)}}),s=new TransformStream({transform:async(o,i)=>{const u=o.type;switch(u){case"text-delta":{i.enqueue(W("text",o.textDelta));break}case"tool-call-streaming-start":{i.enqueue(W("tool_call_streaming_start",{toolCallId:o.toolCallId,toolName:o.toolName}));break}case"tool-call-delta":{i.enqueue(W("tool_call_delta",{toolCallId:o.toolCallId,argsTextDelta:o.argsTextDelta}));break}case"tool-call":{i.enqueue(W("tool_call",{toolCallId:o.toolCallId,toolName:o.toolName,args:o.args}));break}case"tool-result":{i.enqueue(W("tool_result",{toolCallId:o.toolCallId,result:o.result}));break}case"error":{i.enqueue(W("error",t(o.error)));break}case"step-finish":{i.enqueue(W("finish_step",{finishReason:o.finishReason,usage:n?{promptTokens:o.usage.promptTokens,completionTokens:o.usage.completionTokens}:void 0,isContinued:o.isContinued}));break}case"finish":{i.enqueue(W("finish_message",{finishReason:o.finishReason,usage:n?{promptTokens:o.usage.promptTokens,completionTokens:o.usage.completionTokens}:void 0}));break}default:{const l=u;throw new Error(`Unknown chunk type: ${l}`)}}}});return this.fullStream.pipeThrough(a).pipeThrough(s).pipeThrough(new TextEncoderStream)}pipeAIStreamToResponse(e,t){return this.pipeDataStreamToResponse(e,t)}pipeDataStreamToResponse(e,t){const n=t==null?void 0:"init"in t?t.init:{headers:"headers"in t?t.headers:void 0,status:"status"in t?t.status:void 0,statusText:"statusText"in t?t.statusText:void 0},r=t==null?void 0:"data"in t?t.data:void 0,a=t==null?void 0:"getErrorMessage"in t?t.getErrorMessage:void 0,s=t==null?void 0:"sendUsage"in t?t.sendUsage:void 0;fn({response:e,status:n==null?void 0:n.status,statusText:n==null?void 0:n.statusText,headers:pn(n,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"}),stream:this.toDataStream({data:r,getErrorMessage:a,sendUsage:s})})}pipeTextStreamToResponse(e,t){fn({response:e,status:t==null?void 0:t.status,statusText:t==null?void 0:t.statusText,headers:pn(t,{contentType:"text/plain; charset=utf-8"}),stream:this.textStream.pipeThrough(new TextEncoderStream)})}toAIStreamResponse(e){return this.toDataStreamResponse(e)}toDataStream(e){const t=this.toDataStreamInternal({getErrorMessage:e==null?void 0:e.getErrorMessage,sendUsage:e==null?void 0:e.sendUsage});return e!=null&&e.data?yt(e==null?void 0:e.data.stream,t):t}toDataStreamResponse(e){var t;const n=e==null?void 0:"init"in e?e.init:{headers:"headers"in e?e.headers:void 0,status:"status"in e?e.status:void 0,statusText:"statusText"in e?e.statusText:void 0},r=e==null?void 0:"data"in e?e.data:void 0,a=e==null?void 0:"getErrorMessage"in e?e.getErrorMessage:void 0,s=e==null?void 0:"sendUsage"in e?e.sendUsage:void 0;return new Response(this.toDataStream({data:r,getErrorMessage:a,sendUsage:s}),{status:(t=n==null?void 0:n.status)!=null?t:200,statusText:n==null?void 0:n.statusText,headers:Ne(n,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}toTextStreamResponse(e){var t;return new Response(this.textStream.pipeThrough(new TextEncoderStream),{status:(t=e==null?void 0:e.status)!=null?t:200,headers:Ne(e,{contentType:"text/plain; charset=utf-8"})})}},Jl=zi,Ll=({model:e,middleware:{transformParams:t,wrapGenerate:n,wrapStream:r},modelId:a,providerId:s})=>{async function o({params:i,type:u}){return t?await t({params:i,type:u}):i}return{specificationVersion:"v1",provider:s??e.provider,modelId:a??e.modelId,defaultObjectGenerationMode:e.defaultObjectGenerationMode,supportsImageUrls:e.supportsImageUrls,supportsUrl:e.supportsUrl,supportsStructuredOutputs:e.supportsStructuredOutputs,async doGenerate(i){const u=await o({params:i,type:"generate"}),l=async()=>e.doGenerate(u);return n?n({doGenerate:l,params:u,model:e}):l()},async doStream(i){const u=await o({params:i,type:"stream"}),l=async()=>e.doStream(u);return r?r({doStream:l,params:u,model:e}):l()}}};function Bl({languageModels:e,textEmbeddingModels:t,fallbackProvider:n}){return{languageModel(r){if(e!=null&&r in e)return e[r];if(n)return n.languageModel(r);throw new $e({modelId:r,modelType:"languageModel"})},textEmbeddingModel(r){if(t!=null&&r in t)return t[r];if(n)return n.textEmbeddingModel(r);throw new $e({modelId:r,modelType:"textEmbeddingModel"})}}}var hn="AI_NoSuchProviderError",ha=`vercel.ai.error.${hn}`,Ki=Symbol.for(ha),ya,Yi=class extends $e{constructor({modelId:e,modelType:t,providerId:n,availableProviders:r,message:a=`No such provider: ${n} (available providers: ${r.join()})`}){super({errorName:hn,modelId:e,modelType:t,message:a}),this[ya]=!0,this.providerId=n,this.availableProviders=r}static isInstance(e){return I.hasMarker(e,ha)}static isNoSuchProviderError(e){return e instanceof Error&&e.name===hn&&typeof e.providerId=="string"&&Array.isArray(e.availableProviders)}toJSON(){return{name:this.name,message:this.message,stack:this.stack,modelId:this.modelId,modelType:this.modelType,providerId:this.providerId,availableProviders:this.availableProviders}}};ya=Ki;function Hi(e){const t=new Xi;for(const[n,r]of Object.entries(e))t.registerProvider({id:n,provider:r});return t}var Zl=Hi,Xi=class{constructor(){this.providers={}}registerProvider({id:e,provider:t}){this.providers[e]=t}getProvider(e){const t=this.providers[e];if(t==null)throw new Yi({modelId:e,modelType:"languageModel",providerId:e,availableProviders:Object.keys(this.providers)});return t}splitId(e,t){const n=e.indexOf(":");if(n===-1)throw new $e({modelId:e,modelType:t,message:`Invalid ${t} id for registry: ${e} (must be in the format "providerId:modelId")`});return[e.slice(0,n),e.slice(n+1)]}languageModel(e){var t,n;const[r,a]=this.splitId(e,"languageModel"),s=(n=(t=this.getProvider(r)).languageModel)==null?void 0:n.call(t,a);if(s==null)throw new $e({modelId:e,modelType:"languageModel"});return s}textEmbeddingModel(e){var t,n,r;const[a,s]=this.splitId(e,"textEmbeddingModel"),o=this.getProvider(a),i=(r=(t=o.textEmbeddingModel)==null?void 0:t.call(o,s))!=null?r:"textEmbedding"in o?(n=o.textEmbedding)==null?void 0:n.call(o,s):void 0;if(i==null)throw new $e({modelId:e,modelType:"textEmbeddingModel"});return i}textEmbedding(e){return this.textEmbeddingModel(e)}};function Vl(e){return e}function Gl(e,t){if(e.length!==t.length)throw new Error(`Vectors must have the same length (vector1: ${e.length} elements, vector2: ${t.length} elements)`);return _a(e,t)/(Jn(e)*Jn(t))}function _a(e,t){return e.reduce((n,r,a)=>n+r*t[a],0)}function Jn(e){return Math.sqrt(_a(e,e))}function Qi(e){const t=new TextDecoder;let n;return new TransformStream({async start(r){n=Sa(a=>{if("data"in a&&a.type==="event"&&a.data==="[DONE]"||a.event==="done"){r.terminate();return}if("data"in a){const s=e?e(a.data,{event:a.event}):a.data;s&&r.enqueue(s)}})},transform(r){n.feed(t.decode(r))}})}function _e(e){const t=new TextEncoder;let n="";const r=e||{};return new TransformStream({async start(){r.onStart&&await r.onStart()},async transform(a,s){const o=typeof a=="string"?a:a.content;s.enqueue(t.encode(o)),n+=o,r.onToken&&await r.onToken(o),r.onText&&typeof a=="string"&&await r.onText(a)},async flush(){const a=el(r);r.onCompletion&&await r.onCompletion(n),r.onFinal&&!a&&await r.onFinal(n)}})}function el(e){return"experimental_onFunctionCall"in e}function Tn(){let e=!0;return t=>(e&&(t=t.trimStart(),t&&(e=!1)),t)}function Ot(e,t,n){if(!e.ok)if(e.body){const a=e.body.getReader();return new ReadableStream({async start(s){const{done:o,value:i}=await a.read();if(!o){const u=new TextDecoder().decode(i);s.error(new Error(`Response error: ${u}`))}}})}else return new ReadableStream({start(a){a.error(new Error("Response error: No response body"))}});return(e.body||tl()).pipeThrough(Qi(t)).pipeThrough(_e(n))}function tl(){return new ReadableStream({start(e){e.close()}})}function ze(e){let t=e[Symbol.asyncIterator]();return new ReadableStream({async pull(n){const{done:r,value:a}=await t.next();r?n.close():n.enqueue(a)},async cancel(n){var r;await((r=t.return)==null?void 0:r.call(t,n))}})}var nl=class{constructor(){this.encoder=new TextEncoder,this.controller=null,this.isClosed=!1,this.warningTimeout=null;const e=this;this.stream=new ReadableStream({start:async t=>{e.controller=t},pull:t=>{},cancel:t=>{this.isClosed=!0}})}async close(){if(this.isClosed)throw new Error("Data Stream has already been closed.");if(!this.controller)throw new Error("Stream controller is not initialized.");this.controller.close(),this.isClosed=!0,this.warningTimeout&&clearTimeout(this.warningTimeout)}append(e){if(this.isClosed)throw new Error("Data Stream has already been closed.");if(!this.controller)throw new Error("Stream controller is not initialized.");this.controller.enqueue(this.encoder.encode(W("data",[e])))}appendMessageAnnotation(e){if(this.isClosed)throw new Error("Data Stream has already been closed.");if(!this.controller)throw new Error("Stream controller is not initialized.");this.controller.enqueue(this.encoder.encode(W("message_annotations",[e])))}};function pe(){const e=new TextEncoder,t=new TextDecoder;return new TransformStream({transform:async(n,r)=>{const a=t.decode(n);r.enqueue(e.encode(W("text",a)))}})}var zl=class extends nl{};function rl(){let e="";return t=>{const n=JSON.parse(t);if("error"in n)throw new Error(`${n.error.type}: ${n.error.message}`);if(!("completion"in n))return;const r=n.completion;if(!e||r.length>e.length&&r.startsWith(e)){const a=r.slice(e.length);return e=r,a}return r}}async function*al(e){for await(const t of e)if("completion"in t){const n=t.completion;n&&(yield n)}else if("delta"in t){const{delta:n}=t;if("text"in n){const r=n.text;r&&(yield r)}}}function Wl(e,t){return Symbol.asyncIterator in e?ze(al(e)).pipeThrough(_e(t)).pipeThrough(pe()):Ot(e,rl(),t).pipeThrough(pe())}function sl({threadId:e,messageId:t},n){const r=new ReadableStream({async start(a){var s;const o=new TextEncoder,i=d=>{a.enqueue(o.encode(W("assistant_message",d)))},u=d=>{a.enqueue(o.encode(W("data_message",d)))},l=d=>{a.enqueue(o.encode(W("error",d)))},c=async d=>{var f,y;let p;for await(const v of d)switch(v.event){case"thread.message.created":{a.enqueue(o.encode(W("assistant_message",{id:v.data.id,role:"assistant",content:[{type:"text",text:{value:""}}]})));break}case"thread.message.delta":{const T=(f=v.data.delta.content)==null?void 0:f[0];(T==null?void 0:T.type)==="text"&&((y=T.text)==null?void 0:y.value)!=null&&a.enqueue(o.encode(W("text",T.text.value)));break}case"thread.run.completed":case"thread.run.requires_action":{p=v.data;break}}return p};a.enqueue(o.encode(W("assistant_control_data",{threadId:e,messageId:t})));try{await n({threadId:e,messageId:t,sendMessage:i,sendDataMessage:u,forwardStream:c})}catch(d){l((s=d.message)!=null?s:`${d}`)}finally{a.close()}},pull(a){},cancel(){}});return new Response(r,{status:200,headers:{"Content-Type":"text/plain; charset=utf-8"}})}var Kl=sl;async function*ol(e,t){var n,r;const a=new TextDecoder;for await(const s of(n=e.body)!=null?n:[]){const o=(r=s.chunk)==null?void 0:r.bytes;if(o!=null){const i=a.decode(o),u=JSON.parse(i),l=t(u);l!=null&&(yield l)}}}function Yl(e,t){return Mt(e,t,n=>{var r;return(r=n.delta)==null?void 0:r.text})}function Hl(e,t){return Mt(e,t,n=>n.completion)}function Xl(e,t){return Mt(e,t,n=>n==null?void 0:n.text)}function Ql(e,t){return Mt(e,t,n=>n.generation)}function Mt(e,t,n){return ze(ol(e,n)).pipeThrough(_e(t)).pipeThrough(pe())}var il=new TextDecoder("utf-8");async function Ln(e,t){for(const n of e){const{text:r,is_finished:a}=JSON.parse(n);a||t.enqueue(r)}}async function ll(e,t){let n="";for(;;){const{value:r,done:a}=await e.read();if(a)break;n+=il.decode(r,{stream:!0});const s=n.split(/\r\n|\n|\r/g);n=s.pop()||"",await Ln(s,t)}n&&await Ln([n],t),t.close()}function ul(e){var t;const n=(t=e.body)==null?void 0:t.getReader();return new ReadableStream({async start(r){if(!n){r.close();return}await ll(n,r)}})}async function*cl(e){for await(const t of e)if(t.eventType==="text-generation"){const n=t.text;n&&(yield n)}}function eu(e,t){return Symbol.asyncIterator in e?ze(cl(e)).pipeThrough(_e(t)).pipeThrough(pe()):ul(e).pipeThrough(_e(t)).pipeThrough(pe())}async function*dl(e){var t,n,r;for await(const a of e.stream){const s=(r=(n=(t=a.candidates)==null?void 0:t[0])==null?void 0:n.content)==null?void 0:r.parts;if(s===void 0)continue;const o=s[0];typeof o.text=="string"&&(yield o.text)}}function tu(e,t){return ze(dl(e)).pipeThrough(_e(t)).pipeThrough(pe())}function pl(e){const t=Tn();return new ReadableStream({async pull(n){var r,a;const{value:s,done:o}=await e.next();if(o){n.close();return}const i=t((a=(r=s.token)==null?void 0:r.text)!=null?a:"");i&&(s.generated_text!=null&&s.generated_text.length>0||i==="</s>"||i==="<|endoftext|>"||i==="<|end|>"||n.enqueue(i))}})}function nu(e,t){return pl(e).pipeThrough(_e(t)).pipeThrough(pe())}function ru(e,t){if(!e.body)throw new Error("Response body is null");let n="",r;const a=(i,u)=>{var l,c;const{event:d}=u;if(d==="records_cited"&&(r=JSON.parse(i),(l=t==null?void 0:t.onRecordsCited)==null||l.call(t,r)),d==="message_chunk"){const f=JSON.parse(i);return n=(c=f.chat_session_id)!=null?c:n,f.content_chunk}};let{onRecordsCited:s,...o}=t||{};return o={...o,onFinal:i=>{var u;const l={chat_session_id:n,records_cited:r};(u=t==null?void 0:t.onFinal)==null||u.call(t,i,l)}},Ot(e,a,o).pipeThrough(pe())}var fl={};Ur(fl,{toAIStream:()=>ml,toDataStream:()=>xn,toDataStreamResponse:()=>gl});function ml(e,t){return xn(e,t)}function xn(e,t){return e.pipeThrough(new TransformStream({transform:async(n,r)=>{var a;if(typeof n=="string"){r.enqueue(n);return}if("event"in n){n.event==="on_chat_model_stream"&&Bn((a=n.data)==null?void 0:a.chunk,r);return}Bn(n,r)}})).pipeThrough(_e(t)).pipeThrough(pe())}function gl(e,t){var n;const r=xn(e,t==null?void 0:t.callbacks),a=t==null?void 0:t.data,s=t==null?void 0:t.init,o=a?yt(a.stream,r):r;return new Response(o,{status:(n=s==null?void 0:s.status)!=null?n:200,statusText:s==null?void 0:s.statusText,headers:Ne(s,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function Bn(e,t){if(typeof e.content=="string")t.enqueue(e.content);else{const n=e.content;for(const r of n)r.type==="text"&&t.enqueue(r.text)}}var hl={};Ur(hl,{toDataStream:()=>va,toDataStreamResponse:()=>yl});function va(e,t){return _l(e).pipeThrough(_e(t)).pipeThrough(pe())}function yl(e,t={}){var n;const{init:r,data:a,callbacks:s}=t,o=va(e,s),i=a?yt(a.stream,o):o;return new Response(i,{status:(n=r==null?void 0:r.status)!=null?n:200,statusText:r==null?void 0:r.statusText,headers:Ne(r,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function _l(e){const t=e[Symbol.asyncIterator](),n=Tn();return new ReadableStream({async pull(r){var a;const{value:s,done:o}=await t.next();if(o){r.close();return}const i=n((a=s.delta)!=null?a:"");i&&r.enqueue(i)}})}function au(e){const t=new TransformStream,n=t.writable.getWriter(),r=new Set,a=async(i,u)=>{r.delete(u),await n.ready,await n.abort(i)},s=async i=>{r.add(i)},o=async i=>{r.delete(i),r.size===0&&(await n.ready,await n.close())};return{stream:t.readable.pipeThrough(_e(e)).pipeThrough(pe()),writer:n,handlers:{handleLLMNewToken:async i=>{await n.ready,await n.write(i)},handleLLMStart:async(i,u,l)=>{s(l)},handleLLMEnd:async(i,u)=>{await o(u)},handleLLMError:async(i,u)=>{await a(i,u)},handleChainStart:async(i,u,l)=>{s(l)},handleChainEnd:async(i,u)=>{await o(u)},handleChainError:async(i,u)=>{await a(i,u)},handleToolStart:async(i,u,l)=>{s(l)},handleToolEnd:async(i,u)=>{await o(u)},handleToolError:async(i,u)=>{await a(i,u)}}}}async function*vl(e){var t,n;for await(const r of e){const a=(n=(t=r.choices[0])==null?void 0:t.delta)==null?void 0:n.content;a===void 0||a===""||(yield a)}}function su(e,t){return ze(vl(e)).pipeThrough(_e(t)).pipeThrough(pe())}function bl(){const e=ba();return t=>e(JSON.parse(t))}async function*wl(e){const t=ba();for await(let n of e){"promptFilterResults"in n&&(n={id:n.id,created:n.created.getDate(),object:n.object,model:n.model,choices:n.choices.map(a=>{var s,o,i,u,l,c,d;return{delta:{content:(s=a.delta)==null?void 0:s.content,function_call:(o=a.delta)==null?void 0:o.functionCall,role:(i=a.delta)==null?void 0:i.role,tool_calls:(l=(u=a.delta)==null?void 0:u.toolCalls)!=null&&l.length?(d=(c=a.delta)==null?void 0:c.toolCalls)==null?void 0:d.map((f,y)=>({index:y,id:f.id,function:f.function,type:f.type})):void 0},finish_reason:a.finishReason,index:a.index}})});const r=t(n);r&&(yield r)}}function ba(){const e=Tn();let t;return r=>{var a,s,o,i,u,l,c,d,f,y,p,v,T,h,m,w,S,R;if(Vn(r)){const b=(a=r.choices[0])==null?void 0:a.delta;if((s=b.function_call)!=null&&s.name)return t=!0,{isText:!1,content:`{"function_call": {"name": "${b.function_call.name}", "arguments": "`};if((u=(i=(o=b.tool_calls)==null?void 0:o[0])==null?void 0:i.function)!=null&&u.name){t=!0;const k=b.tool_calls[0];return k.index===0?{isText:!1,content:`{"tool_calls":[ {"id": "${k.id}", "type": "function", "function": {"name": "${(l=k.function)==null?void 0:l.name}", "arguments": "`}:{isText:!1,content:`"}}, {"id": "${k.id}", "type": "function", "function": {"name": "${(c=k.function)==null?void 0:c.name}", "arguments": "`}}else{if((d=b.function_call)!=null&&d.arguments)return{isText:!1,content:n((f=b.function_call)==null?void 0:f.arguments)};if((v=(p=(y=b.tool_calls)==null?void 0:y[0])==null?void 0:p.function)!=null&&v.arguments)return{isText:!1,content:n((m=(h=(T=b.tool_calls)==null?void 0:T[0])==null?void 0:h.function)==null?void 0:m.arguments)};if(t&&(((w=r.choices[0])==null?void 0:w.finish_reason)==="function_call"||((S=r.choices[0])==null?void 0:S.finish_reason)==="stop"))return t=!1,{isText:!1,content:'"}}'};if(t&&((R=r.choices[0])==null?void 0:R.finish_reason)==="tool_calls")return t=!1,{isText:!1,content:'"}}]}'}}}return e(Vn(r)&&r.choices[0].delta.content?r.choices[0].delta.content:Sl(r)?r.choices[0].text:"")};function n(r){return`${r.replace(/\\/g,"\\\\").replace(/\//g,"\\/").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\f/g,"\\f")}`}}var Zn=Symbol("internal_openai_fn_messages");function Vn(e){return"choices"in e&&e.choices&&e.choices[0]&&"delta"in e.choices[0]}function Sl(e){return"choices"in e&&e.choices&&e.choices[0]&&"text"in e.choices[0]}function Tl(e,t){const n=t;let r;if(Symbol.asyncIterator in e?r=ze(wl(e)).pipeThrough(_e(n!=null&&n.experimental_onFunctionCall||n!=null&&n.experimental_onToolCall?{...n,onFinal:void 0}:{...n})):r=Ot(e,bl(),n!=null&&n.experimental_onFunctionCall||n!=null&&n.experimental_onToolCall?{...n,onFinal:void 0}:{...n}),n&&(n.experimental_onFunctionCall||n.experimental_onToolCall)){const a=xl(n);return r.pipeThrough(a)}else return r.pipeThrough(pe())}function xl(e){const t=new TextEncoder;let n=!0,r="",a="",s=!1,o=e[Zn]||[];const i=xs();return new TransformStream({async transform(u,l){const c=i(u);if(a+=c,n&&(c.startsWith('{"function_call":')||c.startsWith('{"tool_calls":'))){s=!0,r+=c,n=!1;return}if(s)r+=c;else{l.enqueue(t.encode(W("text",c)));return}},async flush(u){try{if(!n&&s&&(e.experimental_onFunctionCall||e.experimental_onToolCall)){s=!1;const l=JSON.parse(r);let c=[...o],d;if(e.experimental_onFunctionCall){l.function_call===void 0&&console.warn("experimental_onFunctionCall should not be defined when using tools");const v=JSON.parse(l.function_call.arguments);d=await e.experimental_onFunctionCall({name:l.function_call.name,arguments:v},T=>(c=[...o,{role:"assistant",content:"",function_call:l.function_call},{role:"function",name:l.function_call.name,content:JSON.stringify(T)}],c))}if(e.experimental_onToolCall){const v={tools:[]};for(const h of l.tool_calls)v.tools.push({id:h.id,type:"function",func:{name:h.function.name,arguments:JSON.parse(h.function.arguments)}});let T=0;try{d=await e.experimental_onToolCall(v,h=>{if(h){const{tool_call_id:m,function_name:w,tool_call_result:S}=h;c=[...c,...T===0?[{role:"assistant",content:"",tool_calls:l.tool_calls.map(R=>({id:R.id,type:"function",function:{name:R.function.name,arguments:JSON.stringify(R.function.arguments)}}))}]:[],{role:"tool",tool_call_id:m,name:w,content:JSON.stringify(S)}],T++}return c})}catch(h){console.error("Error calling experimental_onToolCall:",h)}}if(d){if(typeof d=="string"){u.enqueue(t.encode(W("text",d))),a=d;return}}else{u.enqueue(t.encode(W(l.function_call?"function_call":"tool_calls",JSON.parse(r))));return}const f={...e,onStart:void 0};e.onFinal=void 0;const p=Tl(d,{...f,[Zn]:c}).getReader();for(;;){const{done:v,value:T}=await p.read();if(v)break;u.enqueue(T)}}}finally{e.onFinal&&a&&await e.onFinal(a)}}})}async function ou(e,t,n){var r;const a=(r=e.urls)==null?void 0:r.stream;if(!a)throw e.error?new Error(e.error):new Error("Missing stream URL in Replicate response");const s=await fetch(a,{method:"GET",headers:{Accept:"text/event-stream",...n==null?void 0:n.headers}});return Ot(s,void 0,t).pipeThrough(pe())}function iu(e,t,n,r){var a;t.writeHead((a=n==null?void 0:n.status)!=null?a:200,{"Content-Type":"text/plain; charset=utf-8",...n==null?void 0:n.headers});let s=e;r&&(s=yt(r.stream,e));const o=s.getReader();function i(){o.read().then(({done:u,value:l})=>{if(u){t.end();return}t.write(l),i()})}i()}var lu=class extends Response{constructor(e,t,n){let r=e;n&&(r=yt(n.stream,e)),super(r,{...t,status:200,headers:Ne(t,{contentType:"text/plain; charset=utf-8"})})}},uu=Or,cu=Or;export{I as AISDKError,Ot as AIStream,Cs as APICallError,Yl as AWSBedrockAnthropicMessagesStream,Hl as AWSBedrockAnthropicStream,Xl as AWSBedrockCohereStream,Ql as AWSBedrockLlama2Stream,Mt as AWSBedrockStream,Wl as AnthropicStream,sl as AssistantResponse,eu as CohereStream,Ut as DownloadError,Cl as EmptyResponseBodyError,tu as GoogleGenerativeAIStream,nu as HuggingFaceStream,ru as InkeepStream,F as InvalidArgumentError,Fn as InvalidDataContentError,Xo as InvalidMessageRoleError,De as InvalidPromptError,Ml as InvalidResponseDataError,ji as InvalidToolArgumentsError,On as JSONParseError,fl as LangChainAdapter,au as LangChainStream,hl as LlamaIndexAdapter,Pl as LoadAPIKeyError,Un as MessageConversionError,su as MistralStream,jl as NoContentGeneratedError,dn as NoObjectGeneratedError,$e as NoSuchModelError,Yi as NoSuchProviderError,Nt as NoSuchToolError,Tl as OpenAIStream,ou as ReplicateStream,$n as RetryError,nl as StreamData,lu as StreamingTextResponse,Fe as TypeValidationError,xt as UnsupportedFunctionalityError,_i as convertToCoreMessages,Gl as cosineSimilarity,_e as createCallbacksTransformer,Qi as createEventStreamTransformer,pe as createStreamDataTransformer,Dl as embed,$l as embedMany,Kl as experimental_AssistantResponse,zl as experimental_StreamData,Zl as experimental_createModelRegistry,Hi as experimental_createProviderRegistry,Bl as experimental_customProvider,ql as experimental_generateObject,Ul as experimental_generateText,Fl as experimental_streamObject,Jl as experimental_streamText,Ll as experimental_wrapLanguageModel,W as formatStreamPart,uu as generateId,ki as generateObject,Ji as generateText,Is as jsonSchema,cu as nanoid,bs as parseStreamPart,Nl as processDataProtocolResponse,Ts as readDataStream,ze as readableFromAsyncIterable,Oi as streamObject,zi as streamText,iu as streamToResponse,Vl as tool,Tn as trimStartOfStreamHelper};
